<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dbt Ã— BigQuery ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #1a73e8;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section-title {
            color: #1a73e8;
            border-bottom: 3px solid #1a73e8;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .key-point {
            background: #e8f0fe;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #1a73e8;
        }
        .dbt-layer-diagram {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
        }
        .layer {
            background: white;
            border: 3px solid;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            position: relative;
        }
        .layer-staging {
            border-color: #ff9800;
            background: linear-gradient(135deg, #fff3e0 0%, #ffffff 100%);
        }
        .layer-intermediate {
            border-color: #2196f3;
            background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
        }
        .layer-mart {
            border-color: #4caf50;
            background: linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%);
        }
        .layer-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .layer-icon {
            font-size: 28px;
        }
        .materialization-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .mat-table {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #c62828;
        }
        .mat-incremental {
            background: #fff3e0;
            color: #e65100;
            border: 1px solid #e65100;
        }
        .mat-view {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #2e7d32;
        }
        .model-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .model-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            font-size: 13px;
        }
        .model-name {
            font-weight: bold;
            color: #1a73e8;
            margin-bottom: 5px;
            font-family: 'Courier New', monospace;
        }
        .model-desc {
            font-size: 11px;
            color: #666;
        }
        .cache-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
            font-size: 11px;
        }
        .cache-good {
            color: #4caf50;
        }
        .cache-bad {
            color: #f44336;
        }
        .code-box {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 15px 0;
            overflow-x: auto;
        }
        .keyword {
            color: #1976d2;
            font-weight: bold;
        }
        .string {
            color: #c62828;
        }
        .comment {
            color: #388e3c;
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .practice-card {
            background: #f8f9fa;
            border: 3px solid;
            border-radius: 8px;
            padding: 20px;
        }
        .good-practice {
            border-color: #4caf50;
        }
        .bad-practice {
            border-color: #f44336;
        }
        .practice-title {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .title-good {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .title-bad {
            background: #ffebee;
            color: #c62828;
        }
        .workflow-viz {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .workflow-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #4285f4;
        }
        .step-number {
            background: #4285f4;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .step-content {
            flex: 1;
        }
        .step-title {
            font-weight: bold;
            color: #1a73e8;
            margin-bottom: 5px;
        }
        .benefit-list {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .benefit-list h4 {
            color: #2e7d32;
            margin-top: 0;
        }
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .warning-box strong {
            color: #e65100;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #e8f0fe;
            color: #1a73e8;
            font-weight: bold;
        }
        tr:hover {
            background: #f5f5f5;
        }
        .highlight {
            background: #fff9c4;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
        .config-example {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .config-title {
            font-weight: bold;
            color: #1a73e8;
            margin-bottom: 15px;
            font-size: 16px;
        }
        .antipattern-box {
            background: #ffebee;
            border: 2px solid #f44336;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .antipattern-item {
            display: flex;
            align-items: flex-start;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 6px;
        }
        .antipattern-icon {
            font-size: 32px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        .strategy-card {
            background: #f8f9fa;
            border: 2px solid #1976d2;
            border-radius: 8px;
            padding: 20px;
        }
        .strategy-card h4 {
            color: #1565c0;
            margin-top: 0;
        }
        .perf-comparison {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .perf-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .perf-bad {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        .perf-good {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }
        .perf-label {
            font-weight: bold;
        }
        .perf-value {
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ dbt Ã— BigQuery ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–</h1>
    <p class="subtitle">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ€å¤§é™ã«æ´»ç”¨ã™ã‚‹dbtãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</p>

    <div class="container">
        <h2 class="section-title">ğŸ“– åŸºæœ¬åŸå‰‡</h2>
        
        <div class="key-point">
            <h3 style="color: #1a73e8; margin-top: 0;">ğŸ¯ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–ã®æ ¸å¿ƒ</h3>
            <p style="font-size: 16px; line-height: 1.8;">
                BigQueryã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯<span class="highlight">ã‚¯ã‚¨ãƒªãƒ†ã‚­ã‚¹ãƒˆãŒã‚­ãƒ¼</span>ã«ãªã‚‹ãŸã‚ã€
                dbtã§åŒã˜ãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§ã™ã‚‹ä¸‹æµãƒ¢ãƒ‡ãƒ«ã¯ã€<span class="highlight">è‡ªå‹•çš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ©æµ</span>ã‚’å—ã‘ã‚‰ã‚Œã¾ã™ã€‚
                é©åˆ‡ãªãƒãƒ†ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆã«ã‚ˆã‚Šã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã‚’æœ€å¤§åŒ–ã§ãã¾ã™ã€‚
            </p>
        </div>

        <div class="benefit-list">
            <h4>âœ¨ dbtãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«æœ‰åˆ©ãªç†ç”±</h4>
            <ul style="font-size: 14px; line-height: 1.8;">
                <li><strong>ä¸€è²«ã—ãŸSQLç”Ÿæˆ:</strong> dbtãŒã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹SQLã¯å¸¸ã«åŒã˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ</li>
                <li><strong>ref()ãƒã‚¯ãƒ­:</strong> ä¸Šæµãƒ¢ãƒ‡ãƒ«ã¸ã®å‚ç…§ãŒæ¨™æº–åŒ–ã•ã‚Œã‚‹</li>
                <li><strong>ãƒ¢ãƒ‡ãƒ«ã®å†åˆ©ç”¨:</strong> è¤‡æ•°ã®ä¸‹æµãƒ¢ãƒ‡ãƒ«ãŒåŒã˜ä¸Šæµãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§</li>
                <li><strong>ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†:</strong> Gitã§ã‚¯ã‚¨ãƒªãƒ†ã‚­ã‚¹ãƒˆãŒä¸€è²«æ€§ã‚’ä¿ã¤</li>
                <li><strong>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼é€£æº:</strong> å®šæœŸå®Ÿè¡Œã§åŒã˜ã‚¯ã‚¨ãƒªãŒç¹°ã‚Šè¿”ã•ã‚Œã‚‹</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">ğŸ—ï¸ æ¨å¥¨ã•ã‚Œã‚‹dbtãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆ</h2>

        <div class="dbt-layer-diagram">
            <h3 style="text-align: center; color: #1a73e8; margin-top: 0;">3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ with ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–</h3>
            
            <div class="layer layer-staging">
                <div class="layer-header">
                    <div class="layer-icon">ğŸ“¥</div>
                    <div>
                        Staging Layer
                        <span class="materialization-badge mat-view">VIEW</span>
                    </div>
                </div>
                <div style="font-size: 14px; color: #666; margin-bottom: 15px;">
                    <strong>ç›®çš„:</strong> ã‚½ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã®è»½é‡ãªæ•´å½¢ï¼ˆãƒªãƒãƒ¼ãƒ ã€å‹å¤‰æ›ã€åŸºæœ¬çš„ãªã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°ï¼‰<br>
                    <strong>ç‰¹å¾´:</strong> é »ç¹ã«æ›´æ–°ã•ã‚Œã‚‹ãŸã‚ VIEW ãŒæœ€é©
                </div>
                <div class="model-list">
                    <div class="model-card">
                        <div class="model-name">stg_customers</div>
                        <div class="model-desc">é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã®åŸºæœ¬æ•´å½¢</div>
                        <div class="cache-indicator cache-good">
                            âš¡ ã‚­ãƒ£ãƒƒã‚·ãƒ¥: ä¸‹æµã§å†åˆ©ç”¨
                        </div>
                    </div>
                    <div class="model-card">
                        <div class="model-name">stg_orders</div>
                        <div class="model-desc">æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®åŸºæœ¬æ•´å½¢</div>
                        <div class="cache-indicator cache-good">
                            âš¡ ã‚­ãƒ£ãƒƒã‚·ãƒ¥: ä¸‹æµã§å†åˆ©ç”¨
                        </div>
                    </div>
                    <div class="model-card">
                        <div class="model-name">stg_products</div>
                        <div class="model-desc">å•†å“ãƒ‡ãƒ¼ã‚¿ã®åŸºæœ¬æ•´å½¢</div>
                        <div class="cache-indicator cache-good">
                            âš¡ ã‚­ãƒ£ãƒƒã‚·ãƒ¥: ä¸‹æµã§å†åˆ©ç”¨
                        </div>
                    </div>
                </div>
                <div class="code-box" style="margin-top: 15px;">
<span class="comment">-- models/staging/stg_customers.sql</span>
{{ config(
    materialized=<span class="string">'view'</span>,
    <span class="comment">-- VIEWã¯å®Ÿè¡Œæ™‚ã«æ¯å›è©•ä¾¡ã•ã‚Œã‚‹ãŒã€</span>
    <span class="comment">-- ä¸‹æµãƒ¢ãƒ‡ãƒ«ã®ã‚¯ã‚¨ãƒªãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹</span>
) }}

<span class="keyword">SELECT</span>
    customer_id,
    customer_name <span class="keyword">AS</span> name,
    email,
    created_at
<span class="keyword">FROM</span> {{ source(<span class="string">'raw'</span>, <span class="string">'customers'</span>) }}
                </div>
            </div>

            <div style="text-align: center; font-size: 32px; color: #4caf50; margin: 15px 0;">â†“</div>

            <div class="layer layer-intermediate">
                <div class="layer-header">
                    <div class="layer-icon">ğŸ”§</div>
                    <div>
                        Intermediate Layer
                        <span class="materialization-badge mat-table">TABLE</span>
                        <span class="materialization-badge mat-incremental">INCREMENTAL</span>
                    </div>
                </div>
                <div style="font-size: 14px; color: #666; margin-bottom: 15px;">
                    <strong>ç›®çš„:</strong> è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€JOINã€é›†è¨ˆ<br>
                    <strong>ç‰¹å¾´:</strong> <span class="highlight">TABLEåŒ–ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å›ºå®š</span>ã€ä¸‹æµã®è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã§å†åˆ©ç”¨
                </div>
                <div class="model-list">
                    <div class="model-card">
                        <div class="model-name">int_customer_orders</div>
                        <div class="model-desc">é¡§å®¢ã¨æ³¨æ–‡ã®JOIN</div>
                        <div class="cache-indicator cache-good">
                            âœ… TABLE: å®Œç’§ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥
                        </div>
                    </div>
                    <div class="model-card">
                        <div class="model-name">int_order_items</div>
                        <div class="model-desc">æ³¨æ–‡æ˜ç´°ã®é›†è¨ˆ</div>
                        <div class="cache-indicator cache-good">
                            âœ… TABLE: å®Œç’§ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥
                        </div>
                    </div>
                    <div class="model-card">
                        <div class="model-name">int_product_metrics</div>
                        <div class="model-desc">å•†å“åˆ¥ã®é›†è¨ˆæŒ‡æ¨™</div>
                        <div class="cache-indicator cache-good">
                            ğŸ“ˆ INCREMENTAL: é«˜é€Ÿæ›´æ–°
                        </div>
                    </div>
                </div>
                <div class="code-box" style="margin-top: 15px;">
<span class="comment">-- models/intermediate/int_customer_orders.sql</span>
{{ config(
    materialized=<span class="string">'table'</span>,
    <span class="comment">-- TABLEã¨ã—ã¦ç‰©ç†åŒ–ã™ã‚‹ã“ã¨ã§:</span>
    <span class="comment">-- 1. ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®ã‚¯ã‚¨ãƒªãŒé«˜é€Ÿ</span>
    <span class="comment">-- 2. ä¸‹æµãƒ¢ãƒ‡ãƒ«ãŒå¸¸ã«åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§</span>
    <span class="comment">-- 3. è¤‡é›‘ãªJOINã‚’ä¸€åº¦ã ã‘å®Ÿè¡Œ</span>
) }}

<span class="keyword">SELECT</span>
    c.customer_id,
    c.name,
    o.order_id,
    o.order_date,
    o.total_amount
<span class="keyword">FROM</span> {{ ref(<span class="string">'stg_customers'</span>) }} c
<span class="keyword">LEFT JOIN</span> {{ ref(<span class="string">'stg_orders'</span>) }} o
    <span class="keyword">ON</span> c.customer_id = o.customer_id
                </div>
            </div>

            <div style="text-align: center; font-size: 32px; color: #4caf50; margin: 15px 0;">â†“</div>

            <div class="layer layer-mart">
                <div class="layer-header">
                    <div class="layer-icon">ğŸ“Š</div>
                    <div>
                        Mart Layer (Business Logic)
                        <span class="materialization-badge mat-view">VIEW</span>
                        <span class="materialization-badge mat-table">TABLE</span>
                    </div>
                </div>
                <div style="font-size: 14px; color: #666; margin-bottom: 15px;">
                    <strong>ç›®çš„:</strong> æœ€çµ‚çš„ãªãƒ“ã‚¸ãƒã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å‘ã‘ãƒ‡ãƒ¼ã‚¿<br>
                    <strong>ç‰¹å¾´:</strong> <span class="highlight">è»½é‡ãªå¤‰æ›ãªã‚‰VIEW</span>ã€é‡ã„é›†è¨ˆãªã‚‰TABLE
                </div>
                <div class="model-list">
                    <div class="model-card">
                        <div class="model-name">fct_daily_sales</div>
                        <div class="model-desc">æ—¥æ¬¡å£²ä¸Šãƒ•ã‚¡ã‚¯ãƒˆ</div>
                        <div class="cache-indicator cache-good">
                            âœ… TABLE: æ¯æ—¥æ›´æ–°
                        </div>
                    </div>
                    <div class="model-card">
                        <div class="model-name">dim_customers</div>
                        <div class="model-desc">é¡§å®¢ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³</div>
                        <div class="cache-indicator cache-good">
                            ğŸ‘ï¸ VIEW: è»½é‡ãªå¤‰æ›
                        </div>
                    </div>
                    <div class="model-card">
                        <div class="model-name">rpt_customer_ltv</div>
                        <div class="model-desc">é¡§å®¢ç”Ÿæ¶¯ä¾¡å€¤ãƒ¬ãƒãƒ¼ãƒˆ</div>
                        <div class="cache-indicator cache-good">
                            âœ… TABLE: è¤‡é›‘ãªè¨ˆç®—
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="warning-box">
            <strong>ğŸ”‘ ãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆã®é‡è¦åŸå‰‡:</strong>
            <ul style="margin: 10px 0; font-size: 14px;">
                <li><strong>Intermediateå±¤ã‚’TABLEåŒ–:</strong> è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¸€åº¦ã ã‘å®Ÿè¡Œã—ã€çµæœã‚’å›ºå®š</li>
                <li><strong>ä¸‹æµã§å†åˆ©ç”¨:</strong> è¤‡æ•°ã®Martãƒ¢ãƒ‡ãƒ«ãŒåŒã˜Intermediateãƒ¢ãƒ‡ãƒ«ã‚’å‚ç…§</li>
                <li><strong>è»½é‡ãªå¤‰æ›ã¯VIEW:</strong> Stagingã¨ã‚·ãƒ³ãƒ—ãƒ«ãªMartã¯VIEWã§ååˆ†</li>
                <li><strong>é‡ã„å‡¦ç†ã¯TABLE:</strong> é›†è¨ˆã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–¢æ•°ã€è¤‡é›‘ãªJOINã¯TABLEåŒ–</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">âœ… ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</h2>

        <div class="strategy-grid">
            <div class="strategy-card">
                <h4>1ï¸âƒ£ å…±é€šã®Intermediateãƒ¢ãƒ‡ãƒ«ã‚’ä½œã‚‹</h4>
                <div style="font-size: 14px; line-height: 1.8;">
                    è¤‡æ•°ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚„ä¸‹æµãƒ¢ãƒ‡ãƒ«ãŒåŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’å¿…è¦ã¨ã™ã‚‹å ´åˆã€
                    Intermediateå±¤ã§å…±é€šãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆã—ã¦TABLEåŒ–ã™ã‚‹ã€‚
                </div>
                <div class="code-box" style="margin-top: 10px;">
<span class="comment">-- âŒ å„Martãƒ¢ãƒ‡ãƒ«ã§å€‹åˆ¥ã«JOIN</span>
<span class="comment">-- mart_sales.sql</span>
<span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> stg_orders
<span class="keyword">JOIN</span> stg_customers ...

<span class="comment">-- mart_returns.sql</span>
<span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> stg_orders
<span class="keyword">JOIN</span> stg_customers ...  <span class="comment">-- é‡è¤‡ï¼</span>

<span class="comment">-- âœ… Intermediateã§å…±é€šåŒ–</span>
<span class="comment">-- int_customer_orders.sql (TABLE)</span>
<span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> stg_orders
<span class="keyword">JOIN</span> stg_customers ...

<span class="comment">-- mart_sales.sql</span>
<span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> {{ ref(<span class="string">'int_customer_orders'</span>) }}

<span class="comment">-- mart_returns.sql</span>
<span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> {{ ref(<span class="string">'int_customer_orders'</span>) }}
                </div>
            </div>

            <div class="strategy-card">
                <h4>2ï¸âƒ£ Ephemeral Modelingã‚’é¿ã‘ã‚‹</h4>
                <div style="font-size: 14px; line-height: 1.8;">
                    ephemeralãƒãƒ†ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ä¸‹æµãƒ¢ãƒ‡ãƒ«ã®ã‚¯ã‚¨ãƒªã«ç›´æ¥åŸ‹ã‚è¾¼ã¾ã‚Œã‚‹ãŸã‚ã€
                    ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ãã«ãã„ã€‚å…±æœ‰ãƒ¢ãƒ‡ãƒ«ã¯TABLEã‹VIEWã«ã€‚
                </div>
                <div class="code-box" style="margin-top: 10px;">
<span class="comment">-- âŒ ephemeral: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ã‹ãªã„</span>
{{ config(materialized=<span class="string">'ephemeral'</span>) }}
<span class="keyword">SELECT</span> ... <span class="comment">-- ã“ã®SQLãŒä¸‹æµã«åŸ‹ã‚è¾¼ã¾ã‚Œã‚‹</span>

<span class="comment">-- âœ… table/view: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ã</span>
{{ config(materialized=<span class="string">'table'</span>) }}
<span class="keyword">SELECT</span> ... <span class="comment">-- ç‰©ç†çš„ãªãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦å­˜åœ¨</span>
                </div>
            </div>

            <div class="strategy-card">
                <h4>3ï¸âƒ£ Incremental Modelã‚’æ´»ç”¨</h4>
                <div style="font-size: 14px; line-height: 1.8;">
                    å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®é›†è¨ˆã¯ã€Incrementalãƒ¢ãƒ‡ãƒ«ã§å·®åˆ†æ›´æ–°ã™ã‚‹ã“ã¨ã§ã€
                    æ¯å›ã®ãƒ•ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ã‚’é¿ã‘ã‚‹ã€‚
                </div>
                <div class="code-box" style="margin-top: 10px;">
{{ config(
    materialized=<span class="string">'incremental'</span>,
    unique_key=<span class="string">'date'</span>,
    partition_by={
        <span class="string">'field'</span>: <span class="string">'date'</span>,
        <span class="string">'data_type'</span>: <span class="string">'date'</span>
    }
) }}

<span class="keyword">SELECT</span>
    <span class="keyword">DATE</span>(order_date) <span class="keyword">AS</span> date,
    <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> order_count,
    <span class="keyword">SUM</span>(amount) <span class="keyword">AS</span> total_sales
<span class="keyword">FROM</span> {{ ref(<span class="string">'stg_orders'</span>) }}
{% <span class="keyword">if</span> is_incremental() %}
    <span class="keyword">WHERE</span> order_date >= (
        <span class="keyword">SELECT</span> <span class="keyword">MAX</span>(date) 
        <span class="keyword">FROM</span> {{ this }}
    )
{% <span class="keyword">endif</span> %}
<span class="keyword">GROUP BY</span> 1
                </div>
            </div>

            <div class="strategy-card">
                <h4>4ï¸âƒ£ dbt_project.ymlã§ä¸€æ‹¬è¨­å®š</h4>
                <div style="font-size: 14px; line-height: 1.8;">
                    ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã«ãƒãƒ†ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ±ä¸€è¨­å®šã™ã‚‹ã“ã¨ã§ã€
                    ä¸€è²«æ€§ã‚’ä¿ã¡ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã‚’æ˜ç¢ºã«ã™ã‚‹ã€‚
                </div>
                <div class="code-box" style="margin-top: 10px;">
<span class="comment"># dbt_project.yml</span>
models:
  my_project:
    staging:
      +materialized: view
      <span class="comment"># Stagingã¯è»½é‡ãªå¤‰æ›ã®ã¿</span>
    
    intermediate:
      +materialized: table
      <span class="comment"># Intermediateã¯é‡ã„å‡¦ç†ã‚’TABLEåŒ–</span>
      <span class="comment"># ä¸‹æµãƒ¢ãƒ‡ãƒ«ãŒä½•åº¦ã‚‚å‚ç…§</span>
    
    marts:
      +materialized: view
      <span class="comment"># Martã¯ç”¨é€”ã«å¿œã˜ã¦å¤‰æ›´</span>
      
      finance:
        +materialized: table
        <span class="comment"># è²¡å‹™ãƒ¬ãƒãƒ¼ãƒˆã¯æ¯æ—¥æ›´æ–°</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">âŒ ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³</h2>

        <div class="antipattern-box">
            <h3 style="color: #c62828; margin-top: 0; text-align: center;">ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŠ¹ç‡ã‚’ä¸‹ã’ã‚‹è¨­è¨ˆ</h3>
            
            <div class="antipattern-item">
                <div class="antipattern-icon">ğŸš«</div>
                <div>
                    <strong style="color: #c62828;">1. ã™ã¹ã¦VIEWã«ã™ã‚‹</strong>
                    <div style="font-size: 13px; color: #666; margin-top: 8px;">
                        è¤‡é›‘ãªJOINã‚„é›†è¨ˆã‚’VIEWã®ã¾ã¾ã«ã™ã‚‹ã¨ã€ä¸‹æµãƒ¢ãƒ‡ãƒ«ã”ã¨ã«åŒã˜é‡ã„å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚
                        Intermediateå±¤ã§TABLEåŒ–ã™ã‚Œã°ã€ä¸€åº¦ã®å®Ÿè¡Œã§æ¸ˆã‚€ã€‚
                    </div>
                    <div class="code-box" style="margin-top: 10px;">
<span class="comment">-- âŒ è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’VIEWã®ã¾ã¾</span>
{{ config(materialized=<span class="string">'view'</span>) }}
<span class="keyword">SELECT</span>
    c.customer_id,
    <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> o.order_id) <span class="keyword">AS</span> total_orders,
    <span class="keyword">SUM</span>(o.amount) <span class="keyword">AS</span> lifetime_value,
    <span class="keyword">AVG</span>(o.amount) <span class="keyword">AS</span> avg_order_value
<span class="keyword">FROM</span> {{ ref(<span class="string">'stg_customers'</span>) }} c
<span class="keyword">LEFT JOIN</span> {{ ref(<span class="string">'stg_orders'</span>) }} o
    <span class="keyword">ON</span> c.customer_id = o.customer_id
<span class="keyword">GROUP BY</span> 1
<span class="comment">-- â†‘ ã“ã®VIEWã‚’å‚ç…§ã™ã‚‹åº¦ã«é‡ã„é›†è¨ˆãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼</span>
                    </div>
                </div>
            </div>

            <div class="antipattern-item">
                <div class="antipattern-icon">ğŸš«</div>
                <div>
                    <strong style="color: #c62828;">2. å„ãƒ¢ãƒ‡ãƒ«ã§å€‹åˆ¥ã«JOIN</strong>
                    <div style="font-size: 13px; color: #666; margin-top: 8px;">
                        åŒã˜ãƒ†ãƒ¼ãƒ–ãƒ«ã®JOINã‚’è¤‡æ•°ã®ãƒ¢ãƒ‡ãƒ«ã§é‡è¤‡ã—ã¦æ›¸ãã¨ã€
                        ãã‚Œãã‚ŒãŒç‹¬ç«‹ã—ãŸã‚¯ã‚¨ãƒªã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ´»ç”¨ã•ã‚Œãªã„ã€‚
                    </div>
                    <div class="code-box" style="margin-top: 10px;">
<span class="comment">-- âŒ mart_sales_by_region.sql</span>
<span class="keyword">SELECT</span> ...
<span class="keyword">FROM</span> {{ ref(<span class="string">'stg_orders'</span>) }} o
<span class="keyword">JOIN</span> {{ ref(<span class="string">'stg_customers'</span>) }} c
    <span class="keyword">ON</span> o.customer_id = c.customer_id
<span class="keyword">JOIN</span> {{ ref(<span class="string">'stg_products'</span>) }} p
    <span class="keyword">ON</span> o.product_id = p.product_id

<span class="comment">-- âŒ mart_sales_by_category.sql</span>
<span class="keyword">SELECT</span> ...
<span class="keyword">FROM</span> {{ ref(<span class="string">'stg_orders'</span>) }} o
<span class="keyword">JOIN</span> {{ ref(<span class="string">'stg_customers'</span>) }} c
    <span class="keyword">ON</span> o.customer_id = c.customer_id
<span class="keyword">JOIN</span> {{ ref(<span class="string">'stg_products'</span>) }} p
    <span class="keyword">ON</span> o.product_id = p.product_id
<span class="comment">-- â†‘ åŒã˜JOINãŒé‡è¤‡ï¼</span>
                    </div>
                </div>
            </div>

            <div class="antipattern-item">
                <div class="antipattern-icon">ğŸš«</div>
                <div>
                    <strong style="color: #c62828;">3. éæ±ºå®šçš„é–¢æ•°ã®å¤šç”¨</strong>
                    <div style="font-size: 13px; color: #666; margin-top: 8px;">
                        CURRENT_TIMESTAMP()ã€RAND()ãªã©ã‚’ä½¿ã†ã¨ã€BigQueryãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã€‚
                        å¿…è¦ãªå ´åˆã®ã¿ä½¿ç”¨ã—ã€å¯èƒ½ãªã‚‰å®šæ•°åŒ–ã™ã‚‹ã€‚
                    </div>
                    <div class="code-box" style="margin-top: 10px;">
<span class="comment">-- âŒ æ¯å›ç•°ãªã‚‹çµæœã«ãªã‚‹ãŸã‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œãªã„</span>
<span class="keyword">SELECT</span>
    *,
    <span class="keyword">CURRENT_TIMESTAMP</span>() <span class="keyword">AS</span> query_time
<span class="keyword">FROM</span> {{ ref(<span class="string">'stg_orders'</span>) }}

<span class="comment">-- âœ… å¿…è¦ãªã‚‰å¤–éƒ¨ã§æ³¨å…¥ã™ã‚‹ã‹ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆæ©Ÿèƒ½ã‚’ä½¿ã†</span>
<span class="keyword">SELECT</span>
    *,
    <span class="string">'{{ var("snapshot_date") }}'</span> <span class="keyword">AS</span> snapshot_date
<span class="keyword">FROM</span> {{ ref(<span class="string">'stg_orders'</span>) }}
                    </div>
                </div>
            </div>

            <div class="antipattern-item">
                <div class="antipattern-icon">ğŸš«</div>
                <div>
                    <strong style="color: #c62828;">4. éåº¦ãªephemeralã®ä½¿ç”¨</strong>
                    <div style="font-size: 13px; color: #666; margin-top: 8px;">
                        ephemeralã¯ä¾¿åˆ©ã ãŒã€ä¸‹æµãƒ¢ãƒ‡ãƒ«ã®ã‚¯ã‚¨ãƒªã«ç›´æ¥åŸ‹ã‚è¾¼ã¾ã‚Œã‚‹ãŸã‚ã€
                        è¤‡æ•°ã®ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹ã¨é‡è¤‡å®Ÿè¡Œã«ãªã‚‹ã€‚
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">ğŸ¯ å®Ÿè·µä¾‹ï¼šåŠ¹æœçš„ãªãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆ</h2>

        <div class="config-example">
            <div class="config-title">ã‚·ãƒŠãƒªã‚ª: Eã‚³ãƒãƒ¼ã‚¹åˆ†æåŸºç›¤</div>
            
            <div class="workflow-viz">
                <div class="workflow-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Staging: è»½é‡ãªæ•´å½¢ (VIEW)</div>
                        <div style="font-size: 13px; color: #666;">
                            <code>stg_orders</code>, <code>stg_customers</code>, <code>stg_products</code><br>
                            åŸºæœ¬çš„ãªãƒªãƒãƒ¼ãƒ ã€å‹å¤‰æ›ã®ã¿
                        </div>
                    </div>
                </div>

                <div class="workflow-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">Intermediate: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ (TABLE)</div>
                        <div style="font-size: 13px; color: #666;">
                            <code>int_order_details</code>: æ³¨æ–‡ã€é¡§å®¢ã€å•†å“ã‚’JOIN<br>
                            <code>int_customer_metrics</code>: é¡§å®¢ã”ã¨ã®é›†è¨ˆæŒ‡æ¨™<br>
                            â†’ ä¸‹æµã®è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã§å†åˆ©ç”¨ã•ã‚Œã‚‹<br>
                            â†’ <strong>TABLEåŒ–ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å›ºå®š</strong>
                        </div>
                    </div>
                </div>

                <div class="workflow-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">Mart: æœ€çµ‚ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ (VIEW or TABLE)</div>
                        <div style="font-size: 13px; color: #666;">
                            <code>fct_daily_sales</code> (TABLE): æ—¥æ¬¡å£²ä¸Šé›†è¨ˆ<br>
                            <code>dim_customers_enriched</code> (VIEW): é¡§å®¢ãƒã‚¹ã‚¿<br>
                            <code>rpt_sales_dashboard</code> (VIEW): ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨<br>
                            â†’ ã™ã¹ã¦<code>int_order_details</code>ã‚’å‚ç…§<br>
                            â†’ <strong>åŒã˜Intermediateãƒ¢ãƒ‡ãƒ«ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ´»ç”¨</strong>
                        </div>
                    </div>
                </div>
            </div>

            <div class="code-box" style="margin-top: 20px;">
<span class="comment">-- models/intermediate/int_order_details.sql</span>
{{ config(
    materialized=<span class="string">'table'</span>,
    partition_by={
        <span class="string">'field'</span>: <span class="string">'order_date'</span>,
        <span class="string">'data_type'</span>: <span class="string">'date'</span>
    }
) }}

<span class="keyword">SELECT</span>
    o.order_id,
    o.order_date,
    o.customer_id,
    c.customer_name,
    c.customer_segment,
    p.product_id,
    p.product_name,
    p.category,
    o.quantity,
    o.unit_price,
    o.quantity * o.unit_price <span class="keyword">AS</span> line_total
<span class="keyword">FROM</span> {{ ref(<span class="string">'stg_orders'</span>) }} o
<span class="keyword">LEFT JOIN</span> {{ ref(<span class="string">'stg_customers'</span>) }} c
    <span class="keyword">ON</span> o.customer_id = c.customer_id
<span class="keyword">LEFT JOIN</span> {{ ref(<span class="string">'stg_products'</span>) }} p
    <span class="keyword">ON</span> o.product_id = p.product_id

<span class="comment">-- â†‘ ã“ã®é‡ã„JOINã¯1æ—¥1å›ã ã‘å®Ÿè¡Œ</span>
<span class="comment">-- â†“ ä¸‹æµã®è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã¯ã“ã®TABLEã‚’å‚ç…§</span>
            </div>

            <div class="code-box">
<span class="comment">-- models/marts/fct_daily_sales.sql</span>
{{ config(materialized=<span class="string">'table'</span>) }}

<span class="keyword">SELECT</span>
    order_date,
    customer_segment,
    category,
    <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> order_id) <span class="keyword">AS</span> order_count,
    <span class="keyword">SUM</span>(line_total) <span class="keyword">AS</span> total_sales
<span class="keyword">FROM</span> {{ ref(<span class="string">'int_order_details'</span>) }}  <span class="comment">-- â† TABLEå‚ç…§</span>
<span class="keyword">GROUP BY</span> 1, 2, 3

<span class="comment">-- âœ… int_order_detailsãŒæ—¢ã«TABLEåŒ–ã•ã‚Œã¦ã„ã‚‹ã®ã§é«˜é€Ÿ</span>
            </div>

            <div class="code-box">
<span class="comment">-- models/marts/rpt_sales_dashboard.sql</span>
{{ config(materialized=<span class="string">'view'</span>) }}

<span class="keyword">SELECT</span>
    customer_segment,
    category,
    <span class="keyword">SUM</span>(line_total) <span class="keyword">AS</span> total_revenue,
    <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> customer_id) <span class="keyword">AS</span> unique_customers
<span class="keyword">FROM</span> {{ ref(<span class="string">'int_order_details'</span>) }}  <span class="comment">-- â† åŒã˜TABLEå‚ç…§</span>
<span class="keyword">WHERE</span> order_date >= <span class="keyword">DATE_SUB</span>(<span class="keyword">CURRENT_DATE</span>(), <span class="keyword">INTERVAL</span> <span class="number">30</span> <span class="keyword">DAY</span>)
<span class="keyword">GROUP BY</span> 1, 2

<span class="comment">-- âœ… åŒã˜int_order_detailsã‚’å‚ç…§ã™ã‚‹ã®ã§ä¸€è²«æ€§ãŒã‚ã‚‹</span>
<span class="comment">-- âœ… è»½é‡ãªå¤‰æ›ãªã®ã§VIEWã§ååˆ†</span>
            </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ</h2>

        <div class="perf-comparison">
            <h3 style="text-align: center; color: #1a73e8; margin-top: 0;">ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ vs ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</h3>
            
            <div style="margin: 20px 0;">
                <strong>ã‚·ãƒŠãƒªã‚ª:</strong> 5ã¤ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒåŒã˜é¡§å®¢ãƒ»æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ç•°ãªã‚‹è¦–ç‚¹ã§åˆ†æ
            </div>

            <div class="perf-row perf-bad">
                <div>
                    <div class="perf-label">âŒ ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³: å„ãƒ¢ãƒ‡ãƒ«ã§å€‹åˆ¥ã«JOIN</div>
                    <div style="font-size: 13px; color: #666; margin-top: 5px;">
                        5ã¤ã®ãƒ¢ãƒ‡ãƒ«ãã‚Œãã‚Œã§é‡ã„JOINã‚’å®Ÿè¡Œ
                    </div>
                </div>
                <div>
                    <div class="perf-value" style="color: #f44336;">5TB</div>
                    <div style="font-size: 12px;">ã‚¹ã‚­ãƒ£ãƒ³é‡</div>
                </div>
            </div>

            <div class="perf-row perf-good">
                <div>
                    <div class="perf-label">âœ… ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹: Intermediateå±¤ã§å…±é€šåŒ–</div>
                    <div style="font-size: 13px; color: #666; margin-top: 5px;">
                        1ã¤ã®Intermediateãƒ¢ãƒ‡ãƒ«(TABLE)ã‚’5ã¤ã®ãƒ¢ãƒ‡ãƒ«ãŒå‚ç…§
                    </div>
                </div>
                <div>
                    <div class="perf-value" style="color: #4caf50;">1TB</div>
                    <div style="font-size: 12px;">ã‚¹ã‚­ãƒ£ãƒ³é‡</div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px; padding: 20px; background: #e8f5e9; border-radius: 8px;">
                <div style="font-size: 24px; font-weight: bold; color: #2e7d32;">
                    ğŸ’° ã‚³ã‚¹ãƒˆå‰Šæ¸›: 80%
                </div>
                <div style="font-size: 14px; color: #666; margin-top: 10px;">
                    5TB Ã— $5/TB = $25 â†’ 1TB Ã— $5/TB = $5<br>
                    <strong>$20ã®ç¯€ç´„ (1å›ã®å®Ÿè¡Œã‚ãŸã‚Š)</strong>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">ğŸ”§ é«˜åº¦ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</h2>

        <div class="comparison-grid">
            <div class="practice-card good-practice">
                <div class="practice-title title-good">âœ… ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æˆ¦ç•¥</div>
                <div class="code-box">
{{ config(
    materialized=<span class="string">'incremental'</span>,
    unique_key=<span class="string">'order_id'</span>,
    partition_by={
        <span class="string">'field'</span>: <span class="string">'order_date'</span>,
        <span class="string">'data_type'</span>: <span class="string">'date'</span>,
        <span class="string">'granularity'</span>: <span class="string">'day'</span>
    },
    cluster_by=[<span class="string">'customer_id'</span>, <span class="string">'product_id'</span>]
) }}

<span class="comment">-- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åŒ–ã§:</span>
<span class="comment">-- 1. å¢—åˆ†æ›´æ–°ãŒé«˜é€Ÿ</span>
<span class="comment">-- 2. ã‚¯ã‚¨ãƒªã®ã‚¹ã‚­ãƒ£ãƒ³é‡å‰Šæ¸›</span>
<span class="comment">-- 3. ã‚³ã‚¹ãƒˆæœ€é©åŒ–</span>
                </div>
                <div style="font-size: 13px; color: #666; margin-top: 10px;">
                    ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã¨ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã§ã€ä¸‹æµã‚¯ã‚¨ãƒªã®ã‚¹ã‚­ãƒ£ãƒ³é‡ã‚’å¤§å¹…å‰Šæ¸›
                </div>
            </div>

            <div class="practice-card good-practice">
                <div class="practice-title title-good">âœ… ãƒã‚¯ãƒ­ã§æ¨™æº–åŒ–</div>
                <div class="code-box">
<span class="comment">-- macros/get_date_spine.sql</span>
{% macro get_date_spine(start_date, end_date) %}
    <span class="keyword">SELECT</span>
        date
    <span class="keyword">FROM</span> <span class="keyword">UNNEST</span>(
        <span class="keyword">GENERATE_DATE_ARRAY</span>(
            <span class="string">'{{ start_date }}'</span>,
            <span class="string">'{{ end_date }}'</span>
        )
    ) <span class="keyword">AS</span> date
{% endmacro %}

<span class="comment">-- è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã§åŒã˜ãƒã‚¯ãƒ­ã‚’ä½¿ç”¨</span>
<span class="comment">-- â†’ ç”Ÿæˆã•ã‚Œã‚‹SQLãŒçµ±ä¸€ã•ã‚Œã‚‹</span>
<span class="comment">-- â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ãã‚„ã™ã„</span>
                </div>
                <div style="font-size: 13px; color: #666; margin-top: 10px;">
                    ãƒã‚¯ãƒ­ã§ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ¨™æº–åŒ–ã—ã€ã‚¯ã‚¨ãƒªãƒ†ã‚­ã‚¹ãƒˆã®ä¸€è²«æ€§ã‚’ä¿ã¤
                </div>
            </div>

            <div class="practice-card good-practice">
                <div class="practice-title title-good">âœ… dbt Snapshotsæ´»ç”¨</div>
                <div class="code-box">
<span class="comment">-- snapshots/customers_snapshot.sql</span>
{% snapshot customers_snapshot %}

{{
    config(
      target_schema=<span class="string">'snapshots'</span>,
      unique_key=<span class="string">'customer_id'</span>,
      strategy=<span class="string">'timestamp'</span>,
      updated_at=<span class="string">'updated_at'</span>,
    )
}}

<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> {{ source(<span class="string">'raw'</span>, <span class="string">'customers'</span>) }}

{% endsnapshot %}

<span class="comment">-- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§å±¥æ­´ç®¡ç†</span>
<span class="comment">-- CURRENT_TIMESTAMPã‚’ä½¿ã‚ãšå›ºå®šãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§</span>
                </div>
                <div style="font-size: 13px; color: #666; margin-top: 10px;">
                    å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã¯Snapshotã§ç®¡ç†ã—ã€éæ±ºå®šçš„é–¢æ•°ã‚’é¿ã‘ã‚‹
                </div>
            </div>

            <div class="practice-card good-practice">
                <div class="practice-title title-good">âœ… dbt Exposuresè¨­å®š</div>
                <div class="code-box">
<span class="comment"># models/marts/schema.yml</span>
exposures:
  - name: sales_dashboard
    type: dashboard
    maturity: high
    url: https://looker.com/dashboards/123
    description: å£²ä¸Šãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    
    depends_on:
      - ref(<span class="string">'fct_daily_sales'</span>)
      - ref(<span class="string">'dim_customers_enriched'</span>)
    
    owner:
      name: Analytics Team
      email: analytics@company.com

<span class="comment"># Exposuresã§ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¢ºåŒ–</span>
<span class="comment"># â†’ å½±éŸ¿ç¯„å›²ã®æŠŠæ¡ãŒå®¹æ˜“</span>
<span class="comment"># â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã®æœ€é©åŒ–</span>
                </div>
                <div style="font-size: 13px; color: #666; margin-top: 10px;">
                    ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨ã®ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤ºã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã‚’æœ€é©åŒ–
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h2>

        <div class="benefit-list">
            <h4>ğŸ¯ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–ã®ãŸã‚ã®dbtè¨­è¨ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h4>
            <table style="margin-top: 15px;">
                <thead>
                    <tr>
                        <th style="width: 50px;">âœ“</th>
                        <th>é …ç›®</th>
                        <th>èª¬æ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="text-align: center;">â˜</td>
                        <td><strong>Intermediateå±¤ã‚’TABLEåŒ–</strong></td>
                        <td>è¤‡é›‘ãªJOINãƒ»é›†è¨ˆã¯Intermediateã§TABLEã¨ã—ã¦ç‰©ç†åŒ–</td>
                    </tr>
                    <tr>
                        <td style="text-align: center;">â˜</td>
                        <td><strong>å…±é€šãƒ¢ãƒ‡ãƒ«ã®æŠ½å‡º</strong></td>
                        <td>è¤‡æ•°ã®ä¸‹æµãƒ¢ãƒ‡ãƒ«ãŒä½¿ã†å‡¦ç†ã‚’å…±é€šIntermediateã«</td>
                    </tr>
                    <tr>
                        <td style="text-align: center;">â˜</td>
                        <td><strong>ephemeralã®æœ€å°åŒ–</strong></td>
                        <td>å…±æœ‰ãƒ¢ãƒ‡ãƒ«ã¯ephemeralã§ã¯ãªãtable/viewã«</td>
                    </tr>
                    <tr>
                        <td style="text-align: center;">â˜</td>
                        <td><strong>éæ±ºå®šçš„é–¢æ•°ã®å›é¿</strong></td>
                        <td>CURRENT_TIMESTAMPç­‰ã¯ä½¿ç”¨ã‚’æœ€å°åŒ–</td>
                    </tr>
                    <tr>
                        <td style="text-align: center;">â˜</td>
                        <td><strong>ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³è¨­å®š</strong></td>
                        <td>æ—¥ä»˜ã‚«ãƒ©ãƒ ã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åŒ–ã—ã¦ã‚¹ã‚­ãƒ£ãƒ³å‰Šæ¸›</td>
                    </tr>
                    <tr>
                        <td style="text-align: center;">â˜</td>
                        <td><strong>Incrementalã®æ´»ç”¨</strong></td>
                        <td>å¤§é‡ãƒ‡ãƒ¼ã‚¿ã¯Incrementalã§å·®åˆ†æ›´æ–°</td>
                    </tr>
                    <tr>
                        <td style="text-align: center;">â˜</td>
                        <td><strong>dbt_project.ymlã§çµ±ä¸€</strong></td>
                        <td>ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã®ãƒãƒ†ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ±ä¸€è¨­å®š</td>
                    </tr>
                    <tr>
                        <td style="text-align: center;">â˜</td>
                        <td><strong>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æœ€é©åŒ–</strong></td>
                        <td>å®Ÿè¡Œé †åºã‚’æœ€é©åŒ–ï¼ˆIntermediate â†’ Martï¼‰</td>
                    </tr>
                    <tr>
                        <td style="text-align: center;">â˜</td>
                        <td><strong>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–</strong></td>
                        <td>ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã¨ä¾å­˜é–¢ä¿‚ã‚’æ–‡æ›¸åŒ–</td>
                    </tr>
                    <tr>
                        <td style="text-align: center;">â˜</td>
                        <td><strong>ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è¨­å®š</strong></td>
                        <td>ã‚¯ã‚¨ãƒªã‚³ã‚¹ãƒˆã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã‚’ç›£è¦–</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ“š ã¾ã¨ã‚</h2>
        <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; border-left: 4px solid #4caf50;">
            <h3 style="color: #2e7d32; margin-top: 0;">ğŸ“ dbt Ã— BigQueryã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–ã®è¦ç‚¹</h3>
            
            <div style="background: #fff3e0; padding: 15px; border-radius: 5px; margin: 15px 0;">
                <strong style="color: #e65100;">ğŸ—ï¸ æ¨å¥¨ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ :</strong>
                <ul style="margin: 10px 0; font-size: 14px;">
                    <li><strong>Staging (VIEW):</strong> è»½é‡ãªæ•´å½¢ã®ã¿ã€é »ç¹ã«æ›´æ–°</li>
                    <li><strong>Intermediate (TABLE):</strong> é‡ã„å‡¦ç†ã‚’ç‰©ç†åŒ–ã€è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã§å†åˆ©ç”¨</li>
                    <li><strong>Mart (VIEW/TABLE):</strong> æœ€çµ‚ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã€ç”¨é€”ã«å¿œã˜ã¦é¸æŠ</li>
                </ul>
            </div>

            <ul style="line-height: 1.8;">
                <li><strong>å…±é€šåŒ–ãŒéµ:</strong> è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ã§ä½¿ã†ãƒ­ã‚¸ãƒƒã‚¯ã¯Intermediateã§å…±é€šåŒ–</li>
                <li><strong>TABLEåŒ–ã§å›ºå®š:</strong> é‡ã„å‡¦ç†ã¯TABLEã¨ã—ã¦ç‰©ç†åŒ–ã—ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å›ºå®š</li>
                <li><strong>ephemeralã‚’é¿ã‘ã‚‹:</strong> å…±æœ‰ãƒ¢ãƒ‡ãƒ«ã¯ephemeralã«ã—ãªã„</li>
                <li><strong>ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æ´»ç”¨:</strong> æ—¥ä»˜ã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åŒ–ã—ã¦ã‚¹ã‚­ãƒ£ãƒ³å‰Šæ¸›</li>
                <li><strong>Incrementalæ›´æ–°:</strong> å¤§é‡ãƒ‡ãƒ¼ã‚¿ã¯å·®åˆ†æ›´æ–°ã§åŠ¹ç‡åŒ–</li>
                <li><strong>éæ±ºå®šçš„é–¢æ•°ã‚’é¿ã‘ã‚‹:</strong> CURRENT_TIMESTAMPç­‰ã¯æœ€å°é™ã«</li>
                <li><strong>çµ±ä¸€è¨­å®š:</strong> dbt_project.ymlã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã«ä¸€æ‹¬è¨­å®š</li>
            </ul>

            <div style="background: #e3f2fd; padding: 15px; border-radius: 5px; margin-top: 15px;">
                <strong style="color: #1565c0;">ğŸ’¡ å®Ÿè·µçš„ãªåŠ¹æœ:</strong>
                <ul style="margin: 10px 0; font-size: 14px;">
                    <li>ã‚¯ã‚¨ãƒªã‚³ã‚¹ãƒˆ: æœ€å¤§80ã€œ90%å‰Šæ¸›</li>
                    <li>å®Ÿè¡Œæ™‚é–“: 10ã€œ100å€é«˜é€ŸåŒ–</li>
                    <li>é–‹ç™ºåŠ¹ç‡: ãƒ¢ãƒ‡ãƒ«å†åˆ©ç”¨ã«ã‚ˆã‚‹ç”Ÿç”£æ€§å‘ä¸Š</li>
                    <li>ä¿å®ˆæ€§: ä¸€è²«ã—ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ç®¡ç†å®¹æ˜“</li>
                </ul>
            </div>

            <div style="text-align: center; margin-top: 20px; font-size: 18px; font-weight: bold; color: #2e7d32;">
                é©åˆ‡ãªdbtãƒ¬ã‚¤ãƒ¤ãƒ¼è¨­è¨ˆã«ã‚ˆã‚Šã€<br>
                BigQueryã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ€å¤§é™ã«æ´»ç”¨ã—ã€<br>
                ã‚³ã‚¹ãƒˆã¨æ™‚é–“ã®ä¸¡æ–¹ã‚’å¤§å¹…ã«å‰Šæ¸›ã§ãã¾ã™ï¼
            </div>
        </div>
    </div>

</body>
</html>
