<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dbt Incremental Model è§£èª¬</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #ff694b;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section-title {
            color: #ff694b;
            border-bottom: 3px solid #ff694b;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .key-point {
            background: #fff4f2;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ff694b;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .comparison-card {
            background: #f8f9fa;
            border: 3px solid;
            border-radius: 8px;
            padding: 20px;
        }
        .card-table {
            border-color: #4caf50;
        }
        .card-incremental {
            border-color: #ff694b;
        }
        .card-title {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .title-table {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .title-incremental {
            background: #fff4f2;
            color: #d84315;
        }
        .execution-viz {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #e0e0e0;
        }
        .data-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .flow-box {
            background: white;
            border: 3px solid;
            border-radius: 8px;
            padding: 20px;
            min-width: 150px;
            text-align: center;
        }
        .box-source {
            border-color: #2196f3;
            background: #e3f2fd;
        }
        .box-target {
            border-color: #ff694b;
            background: #fff4f2;
        }
        .box-result {
            border-color: #4caf50;
            background: #e8f5e9;
        }
        .box-icon {
            font-size: 36px;
            margin-bottom: 10px;
        }
        .box-title {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 15px;
        }
        .box-desc {
            font-size: 12px;
            color: #666;
        }
        .arrow {
            font-size: 36px;
            color: #ff694b;
            font-weight: bold;
        }
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        .strategy-card {
            background: #f8f9fa;
            border: 2px solid #ff694b;
            border-radius: 8px;
            padding: 20px;
        }
        .strategy-card h4 {
            color: #ff694b;
            margin-top: 0;
        }
        .strategy-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        .code-box {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 15px 0;
            overflow-x: auto;
        }
        .keyword {
            color: #1976d2;
            font-weight: bold;
        }
        .string {
            color: #c62828;
        }
        .comment {
            color: #388e3c;
        }
        .function {
            color: #7b1fa2;
            font-weight: bold;
        }
        .highlight {
            background: #fff9c4;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
        .timeline {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
        }
        .timeline-step {
            display: flex;
            align-items: flex-start;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #ff694b;
        }
        .step-number {
            background: #ff694b;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            margin-right: 20px;
            flex-shrink: 0;
        }
        .step-content {
            flex: 1;
        }
        .step-title {
            font-weight: bold;
            color: #ff694b;
            margin-bottom: 8px;
            font-size: 16px;
        }
        .step-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.8;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #fff4f2;
            color: #d84315;
            font-weight: bold;
        }
        tr:hover {
            background: #f5f5f5;
        }
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .warning-box strong {
            color: #e65100;
        }
        .benefit-list {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .benefit-list h4 {
            color: #2e7d32;
            margin-top: 0;
        }
        .data-example {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .data-table {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .data-new {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }
        .data-existing {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        .data-updated {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        .config-section {
            background: #f8f9fa;
            border: 2px solid #ff694b;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .config-option {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        .config-option h4 {
            color: #ff694b;
            margin-top: 0;
            font-size: 15px;
        }
        .use-case {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .use-case h4 {
            margin-top: 0;
            color: #2e7d32;
        }
        .performance-comparison {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .perf-bar {
            background: #f8f9fa;
            border-radius: 6px;
            margin: 15px 0;
            padding: 10px;
        }
        .perf-label {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .perf-meter {
            background: #e0e0e0;
            height: 30px;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .perf-fill {
            height: 100%;
            display: flex;
            align-items: center;
            padding-left: 10px;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
        .perf-slow {
            background: #f44336;
            width: 100%;
        }
        .perf-fast {
            background: #4caf50;
            width: 10%;
        }
    </style>
</head>
<body>
    <h1>âš¡ dbt Incremental Model</h1>
    <p class="subtitle">å¤§é‡ãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã™ã‚‹å¢—åˆ†æ›´æ–°ãƒ¢ãƒ‡ãƒ«</p>

    <div class="container">
        <h2 class="section-title">ğŸ“– Incremental Modelã¨ã¯</h2>
        
        <div class="key-point">
            <h3 style="color: #ff694b; margin-top: 0;">ğŸ¯ æ¦‚è¦</h3>
            <p style="font-size: 16px; line-height: 1.8;">
                Incremental Modelï¼ˆå¢—åˆ†ãƒ¢ãƒ‡ãƒ«ï¼‰ã¯ã€<span class="highlight">æ—¢å­˜ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾ã—ã¦æ–°è¦ãƒ‡ãƒ¼ã‚¿ã‚„å¤‰æ›´ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’è¿½åŠ ãƒ»æ›´æ–°</span>ã™ã‚‹ã€dbtã®åŠ¹ç‡çš„ãªãƒãƒ†ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³æ–¹å¼ã§ã™ã€‚
                æ¯å›å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å†æ§‹ç¯‰ã™ã‚‹TABLEãƒ¢ãƒ‡ãƒ«ã¨ç•°ãªã‚Šã€å·®åˆ†ãƒ‡ãƒ¼ã‚¿ã ã‘ã‚’å‡¦ç†ã™ã‚‹ã“ã¨ã§ï¼š
            </p>
            <ul style="font-size: 15px; line-height: 1.8;">
                <li><strong>å‡¦ç†æ™‚é–“ã®å¤§å¹…çŸ­ç¸®:</strong> å…¨ãƒ‡ãƒ¼ã‚¿ã§ã¯ãªãæ–°è¦ãƒ‡ãƒ¼ã‚¿ã®ã¿å‡¦ç†</li>
                <li><strong>ã‚³ã‚¹ãƒˆå‰Šæ¸›:</strong> ã‚¹ã‚­ãƒ£ãƒ³é‡ãƒ»è¨ˆç®—é‡ãŒæ¿€æ¸›</li>
                <li><strong>ãƒªã‚½ãƒ¼ã‚¹åŠ¹ç‡åŒ–:</strong> ãƒ‡ãƒ¼ã‚¿ã‚¦ã‚§ã‚¢ãƒã‚¦ã‚¹ã®è² è·è»½æ¸›</li>
                <li><strong>é »ç¹ãªæ›´æ–°ãŒå¯èƒ½:</strong> æ¯æ™‚ãƒ»æ¯åˆ†ã®æ›´æ–°ã‚‚ç¾å®Ÿçš„ã«</li>
            </ul>
        </div>

        <div class="comparison">
            <div class="comparison-card card-table">
                <div class="card-title title-table">ğŸ”„ TABLEãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ•ãƒ«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼‰</div>
                
                <div style="margin: 20px 0;">
                    <div style="font-size: 14px; margin-bottom: 15px; font-weight: bold;">
                        æ¯å›å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å†æ§‹ç¯‰
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 6px; border: 2px solid #4caf50;">
                        <div style="font-size: 13px; line-height: 1.8;">
                            <strong>Day 1:</strong> 100ä¸‡è¡Œã‚’å‡¦ç† â†’ ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ<br>
                            <strong>Day 2:</strong> 100ä¸‡è¡Œã‚’å‡¦ç† â†’ ãƒ†ãƒ¼ãƒ–ãƒ«å†ä½œæˆ<br>
                            <strong>Day 3:</strong> 100ä¸‡è¡Œã‚’å‡¦ç† â†’ ãƒ†ãƒ¼ãƒ–ãƒ«å†ä½œæˆ<br>
                            ...<br>
                            <strong>Day 30:</strong> 100ä¸‡è¡Œã‚’å‡¦ç† â†’ ãƒ†ãƒ¼ãƒ–ãƒ«å†ä½œæˆ
                        </div>
                    </div>
                </div>

                <div style="background: #ffebee; padding: 15px; border-radius: 5px; margin-top: 15px;">
                    <strong style="color: #c62828;">âš ï¸ èª²é¡Œ:</strong>
                    <ul style="font-size: 13px; margin: 10px 0;">
                        <li>ãƒ‡ãƒ¼ã‚¿é‡ãŒå¢—ãˆã‚‹ã¨å‡¦ç†æ™‚é–“ãŒç·šå½¢å¢—åŠ </li>
                        <li>æ¯å›ãƒ•ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ â†’ é«˜ã‚³ã‚¹ãƒˆ</li>
                        <li>å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã¯å®Ÿè¡Œä¸å¯èƒ½ã«</li>
                        <li>é »ç¹ãªæ›´æ–°ãŒå›°é›£</li>
                    </ul>
                </div>
            </div>

            <div class="comparison-card card-incremental">
                <div class="card-title title-incremental">âš¡ Incrementalãƒ¢ãƒ‡ãƒ«ï¼ˆå·®åˆ†æ›´æ–°ï¼‰</div>
                
                <div style="margin: 20px 0;">
                    <div style="font-size: 14px; margin-bottom: 15px; font-weight: bold;">
                        æ–°è¦ãƒ»å¤‰æ›´ãƒ‡ãƒ¼ã‚¿ã®ã¿å‡¦ç†
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 6px; border: 2px solid #ff694b;">
                        <div style="font-size: 13px; line-height: 1.8;">
                            <strong>Day 1:</strong> 100ä¸‡è¡Œã‚’å‡¦ç† â†’ ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ<br>
                            <strong>Day 2:</strong> æ–°è¦1ä¸‡è¡Œã®ã¿å‡¦ç† â†’ è¿½åŠ <br>
                            <strong>Day 3:</strong> æ–°è¦1ä¸‡è¡Œã®ã¿å‡¦ç† â†’ è¿½åŠ <br>
                            ...<br>
                            <strong>Day 30:</strong> æ–°è¦1ä¸‡è¡Œã®ã¿å‡¦ç† â†’ è¿½åŠ 
                        </div>
                    </div>
                </div>

                <div style="background: #e8f5e9; padding: 15px; border-radius: 5px; margin-top: 15px;">
                    <strong style="color: #2e7d32;">âœ… ãƒ¡ãƒªãƒƒãƒˆ:</strong>
                    <ul style="font-size: 13px; margin: 10px 0;">
                        <li>å‡¦ç†æ™‚é–“ãŒã»ã¼ä¸€å®š</li>
                        <li>å·®åˆ†ã®ã¿ã‚¹ã‚­ãƒ£ãƒ³ â†’ ä½ã‚³ã‚¹ãƒˆ</li>
                        <li>å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã‚‚é«˜é€Ÿ</li>
                        <li>æ¯æ™‚ãƒ»æ¯åˆ†ã®æ›´æ–°ã‚‚å¯èƒ½</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">ğŸ”„ Incrementalã®å‡¦ç†ãƒ•ãƒ­ãƒ¼</h2>

        <div class="timeline">
            <h3 style="text-align: center; color: #ff694b; margin-top: 0;">åˆå›å®Ÿè¡Œã¨2å›ç›®ä»¥é™ã®é•ã„</h3>
            
            <div style="background: #e3f2fd; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                <strong style="color: #1565c0;">ğŸ†• åˆå›å®Ÿè¡Œï¼ˆis_incremental() = Falseï¼‰</strong>
                <div style="font-size: 14px; margin-top: 8px;">
                    ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã€ãƒ•ãƒ«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã¨åŒã˜å‹•ä½œ
                </div>
            </div>
            
            <div class="timeline-step" style="border-left-color: #2196f3;">
                <div class="step-number" style="background: #2196f3;">1</div>
                <div class="step-content">
                    <div class="step-title">å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—</div>
                    <div class="step-desc">
                        ã‚½ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å…¨ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’SELECTã€‚<br>
                        <code>WHERE</code>å¥ã®å¢—åˆ†ãƒ•ã‚£ãƒ«ã‚¿ã¯é©ç”¨ã•ã‚Œãªã„ã€‚
                    </div>
                </div>
            </div>

            <div class="timeline-step" style="border-left-color: #2196f3;">
                <div class="step-number" style="background: #2196f3;">2</div>
                <div class="step-content">
                    <div class="step-title">ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ</div>
                    <div class="step-desc">
                        <code>CREATE TABLE</code>ã§æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã€å…¨ãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥ã€‚<br>
                        ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³è¨­å®šã‚„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚‚é©ç”¨ã€‚
                    </div>
                </div>
            </div>

            <div style="background: #fff4f2; padding: 15px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #ff694b;">
                <strong style="color: #d84315;">âš¡ 2å›ç›®ä»¥é™ã®å®Ÿè¡Œï¼ˆis_incremental() = Trueï¼‰</strong>
                <div style="font-size: 14px; margin-top: 8px;">
                    ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ãŸã‚ã€å·®åˆ†ãƒ‡ãƒ¼ã‚¿ã®ã¿å‡¦ç†
                </div>
            </div>

            <div class="timeline-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">å·®åˆ†ãƒ‡ãƒ¼ã‚¿ã®ã¿å–å¾—</div>
                    <div class="step-desc">
                        <code>WHERE</code>å¥ã§æ–°è¦ãƒ‡ãƒ¼ã‚¿ã ã‘ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€‚<br>
                        ä¾‹: <code>WHERE created_at > (SELECT MAX(created_at) FROM existing_table)</code>
                    </div>
                </div>
            </div>

            <div class="timeline-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ãƒãƒ¼ã‚¸</div>
                    <div class="step-desc">
                        é¸æŠã—ãŸæˆ¦ç•¥ã«å¿œã˜ã¦å‡¦ç†:<br>
                        â€¢ <strong>append:</strong> å˜ç´”ã«è¿½åŠ <br>
                        â€¢ <strong>merge:</strong> unique_keyã§é‡è¤‡ã‚’æ›´æ–°<br>
                        â€¢ <strong>delete+insert:</strong> å¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦æŒ¿å…¥
                    </div>
                </div>
            </div>

            <div class="timeline-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°</div>
                    <div class="step-desc">
                        å·®åˆ†ãƒ‡ãƒ¼ã‚¿ãŒæ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã«çµ±åˆã•ã‚Œã‚‹ã€‚<br>
                        å…¨ãƒ‡ãƒ¼ã‚¿ã®å†æ§‹ç¯‰ã¯è¡Œã‚ãªã„ã€‚
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">ğŸ¯ Incrementalæˆ¦ç•¥</h2>

        <div style="background: #fff4f2; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            <strong style="color: #d84315;">ğŸ“Œ æˆ¦ç•¥ã¨ã¯:</strong>
            <p style="margin: 10px 0; font-size: 14px;">
                æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨æ–°è¦ãƒ‡ãƒ¼ã‚¿ã‚’ã©ã®ã‚ˆã†ã«çµ±åˆã™ã‚‹ã‹ã‚’å®šç¾©ã™ã‚‹æ–¹æ³•ã€‚<br>
                <code>materialized='incremental'</code>ã¨<code>incremental_strategy</code>ã§æŒ‡å®šã€‚
            </p>
        </div>

        <div class="strategy-grid">
            <div class="strategy-card">
                <div class="strategy-icon">â•</div>
                <h4>1. appendï¼ˆè¿½åŠ ï¼‰</h4>
                <div style="font-size: 14px; line-height: 1.8;">
                    <strong>å‹•ä½œ:</strong> æ–°è¦ãƒ‡ãƒ¼ã‚¿ã‚’å˜ç´”ã«è¿½åŠ ï¼ˆINSERTï¼‰<br>
                    <strong>SQL:</strong> <code>INSERT INTO table SELECT ...</code><br>
                    <strong>é©ç”¨:</strong> ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ†ãƒ¼ãƒ–ãƒ«<br>
                    <strong>æ³¨æ„:</strong> é‡è¤‡ãƒ‡ãƒ¼ã‚¿ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§
                </div>
                <div class="code-box" style="margin-top: 10px; font-size: 11px;">
{{ <span class="function">config</span>(
    materialized=<span class="string">'incremental'</span>,
    incremental_strategy=<span class="string">'append'</span>
) }}
                </div>
            </div>

            <div class="strategy-card">
                <div class="strategy-icon">ğŸ”€</div>
                <h4>2. mergeï¼ˆãƒãƒ¼ã‚¸ï¼‰</h4>
                <div style="font-size: 14px; line-height: 1.8;">
                    <strong>å‹•ä½œ:</strong> unique_keyã§é‡è¤‡ãƒã‚§ãƒƒã‚¯ã€æ›´æ–° or æŒ¿å…¥<br>
                    <strong>SQL:</strong> <code>MERGE</code>æ–‡ï¼ˆUPSERTï¼‰<br>
                    <strong>é©ç”¨:</strong> ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ã€CDC<br>
                    <strong>æ³¨æ„:</strong> unique_keyãŒå¿…é ˆ
                </div>
                <div class="code-box" style="margin-top: 10px; font-size: 11px;">
{{ <span class="function">config</span>(
    materialized=<span class="string">'incremental'</span>,
    incremental_strategy=<span class="string">'merge'</span>,
    unique_key=<span class="string">'id'</span>
) }}
                </div>
            </div>

            <div class="strategy-card">
                <div class="strategy-icon">ğŸ—‘ï¸</div>
                <h4>3. delete+insert</h4>
                <div style="font-size: 14px; line-height: 1.8;">
                    <strong>å‹•ä½œ:</strong> è©²å½“æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦æŒ¿å…¥<br>
                    <strong>SQL:</strong> <code>DELETE WHERE ... INSERT ...</code><br>
                    <strong>é©ç”¨:</strong> æ—¥æ¬¡é›†è¨ˆã€æœŸé–“ãƒ™ãƒ¼ã‚¹æ›´æ–°<br>
                    <strong>æ³¨æ„:</strong> ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åˆ—ãŒå¿…è¦
                </div>
                <div class="code-box" style="margin-top: 10px; font-size: 11px;">
{{ <span class="function">config</span>(
    materialized=<span class="string">'incremental'</span>,
    incremental_strategy=<span class="string">'delete+insert'</span>,
    partition_by={<span class="string">'field'</span>: <span class="string">'date'</span>}
) }}
                </div>
            </div>

            <div class="strategy-card">
                <div class="strategy-icon">ğŸ“Š</div>
                <h4>4. insert_overwrite</h4>
                <div style="font-size: 14px; line-height: 1.8;">
                    <strong>å‹•ä½œ:</strong> ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³å˜ä½ã§ä¸Šæ›¸ã<br>
                    <strong>SQL:</strong> ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ç½®æ›<br>
                    <strong>é©ç”¨:</strong> BigQueryã€Sparkã€Hive<br>
                    <strong>æ³¨æ„:</strong> ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«å°‚ç”¨
                </div>
                <div class="code-box" style="margin-top: 10px; font-size: 11px;">
{{ <span class="function">config</span>(
    materialized=<span class="string">'incremental'</span>,
    incremental_strategy=<span class="string">'insert_overwrite'</span>,
    partition_by={<span class="string">'field'</span>: <span class="string">'date'</span>}
) }}
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">ğŸ’» å®Ÿè£…ä¾‹</h2>

        <h3 style="color: #ff694b;">1. åŸºæœ¬çš„ãªIncremental Modelï¼ˆappendæˆ¦ç•¥ï¼‰</h3>
        <div class="code-box">
<span class="comment">-- models/events_incremental.sql</span>
{{ <span class="function">config</span>(
    materialized=<span class="string">'incremental'</span>,
    incremental_strategy=<span class="string">'append'</span>,
    partition_by={
        <span class="string">'field'</span>: <span class="string">'event_date'</span>,
        <span class="string">'data_type'</span>: <span class="string">'date'</span>,
        <span class="string">'granularity'</span>: <span class="string">'day'</span>
    },
    cluster_by=[<span class="string">'user_id'</span>, <span class="string">'event_type'</span>]
) }}

<span class="keyword">SELECT</span>
    event_id,
    user_id,
    event_type,
    event_timestamp,
    <span class="function">DATE</span>(event_timestamp) <span class="keyword">AS</span> event_date,
    properties
<span class="keyword">FROM</span> {{ <span class="function">source</span>(<span class="string">'raw'</span>, <span class="string">'events'</span>) }}

<span class="comment">-- å¢—åˆ†ãƒ•ã‚£ãƒ«ã‚¿: 2å›ç›®ä»¥é™ã®ã¿é©ç”¨</span>
{% <span class="keyword">if</span> <span class="function">is_incremental</span>() %}
    <span class="keyword">WHERE</span> event_timestamp > (<span class="keyword">SELECT MAX</span>(event_timestamp) <span class="keyword">FROM</span> {{ <span class="keyword">this</span> }})
{% <span class="keyword">endif</span> %}
        </div>

        <h3 style="color: #ff694b; margin-top: 30px;">2. mergeæˆ¦ç•¥ï¼ˆãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰</h3>
        <div class="code-box">
<span class="comment">-- models/dim_customers_incremental.sql</span>
{{ <span class="function">config</span>(
    materialized=<span class="string">'incremental'</span>,
    incremental_strategy=<span class="string">'merge'</span>,
    unique_key=<span class="string">'customer_id'</span>,
    merge_update_columns=[<span class="string">'name'</span>, <span class="string">'email'</span>, <span class="string">'updated_at'</span>]
) }}

<span class="keyword">SELECT</span>
    customer_id,
    name,
    email,
    created_at,
    updated_at
<span class="keyword">FROM</span> {{ <span class="function">source</span>(<span class="string">'raw'</span>, <span class="string">'customers'</span>) }}

{% <span class="keyword">if</span> <span class="function">is_incremental</span>() %}
    <span class="comment">-- æ›´æ–°ã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿å–å¾—</span>
    <span class="keyword">WHERE</span> updated_at > (<span class="keyword">SELECT MAX</span>(updated_at) <span class="keyword">FROM</span> {{ <span class="keyword">this</span> }})
{% <span class="keyword">endif</span> %}
        </div>

        <h3 style="color: #ff694b; margin-top: 30px;">3. delete+insertæˆ¦ç•¥ï¼ˆæ—¥æ¬¡é›†è¨ˆï¼‰</h3>
        <div class="code-box">
<span class="comment">-- models/fct_daily_sales.sql</span>
{{ <span class="function">config</span>(
    materialized=<span class="string">'incremental'</span>,
    incremental_strategy=<span class="string">'delete+insert'</span>,
    partition_by={
        <span class="string">'field'</span>: <span class="string">'sale_date'</span>,
        <span class="string">'data_type'</span>: <span class="string">'date'</span>
    }
) }}

<span class="keyword">SELECT</span>
    <span class="function">DATE</span>(sale_timestamp) <span class="keyword">AS</span> sale_date,
    product_id,
    <span class="function">SUM</span>(quantity) <span class="keyword">AS</span> total_quantity,
    <span class="function">SUM</span>(amount) <span class="keyword">AS</span> total_amount,
    <span class="function">COUNT</span>(<span class="keyword">DISTINCT</span> customer_id) <span class="keyword">AS</span> unique_customers
<span class="keyword">FROM</span> {{ <span class="function">ref</span>(<span class="string">'stg_sales'</span>) }}

{% <span class="keyword">if</span> <span class="function">is_incremental</span>() %}
    <span class="comment">-- éå»7æ—¥åˆ†ã‚’å†è¨ˆç®—ï¼ˆé…å»¶ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰</span>
    <span class="keyword">WHERE</span> <span class="function">DATE</span>(sale_timestamp) >= <span class="function">DATE_SUB</span>(<span class="function">CURRENT_DATE</span>(), <span class="keyword">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>)
{% <span class="keyword">endif</span> %}

<span class="keyword">GROUP BY</span> <span class="number">1</span>, <span class="number">2</span>
        </div>

        <h3 style="color: #ff694b; margin-top: 30px;">4. è¤‡åˆã‚­ãƒ¼ã§ã®merge</h3>
        <div class="code-box">
<span class="comment">-- models/fct_order_items.sql</span>
{{ <span class="function">config</span>(
    materialized=<span class="string">'incremental'</span>,
    incremental_strategy=<span class="string">'merge'</span>,
    unique_key=[<span class="string">'order_id'</span>, <span class="string">'item_id'</span>],  <span class="comment">-- è¤‡åˆã‚­ãƒ¼</span>
    partition_by={<span class="string">'field'</span>: <span class="string">'order_date'</span>, <span class="string">'data_type'</span>: <span class="string">'date'</span>}
) }}

<span class="keyword">SELECT</span>
    order_id,
    item_id,
    order_date,
    quantity,
    price,
    discount,
    updated_at
<span class="keyword">FROM</span> {{ <span class="function">source</span>(<span class="string">'raw'</span>, <span class="string">'order_items'</span>) }}

{% <span class="keyword">if</span> <span class="function">is_incremental</span>() %}
    <span class="keyword">WHERE</span> updated_at > (<span class="keyword">SELECT MAX</span>(updated_at) <span class="keyword">FROM</span> {{ <span class="keyword">this</span> }})
{% <span class="keyword">endif</span> %}
        </div>

        <h3 style="color: #ff694b; margin-top: 30px;">5. insert_overwriteæˆ¦ç•¥ï¼ˆBigQueryï¼‰</h3>
        <div class="code-box">
<span class="comment">-- models/fct_hourly_metrics.sql</span>
{{ <span class="function">config</span>(
    materialized=<span class="string">'incremental'</span>,
    incremental_strategy=<span class="string">'insert_overwrite'</span>,
    partition_by={
        <span class="string">'field'</span>: <span class="string">'metric_hour'</span>,
        <span class="string">'data_type'</span>: <span class="string">'timestamp'</span>,
        <span class="string">'granularity'</span>: <span class="string">'hour'</span>
    }
) }}

<span class="keyword">SELECT</span>
    <span class="function">TIMESTAMP_TRUNC</span>(event_timestamp, <span class="keyword">HOUR</span>) <span class="keyword">AS</span> metric_hour,
    metric_name,
    <span class="function">AVG</span>(metric_value) <span class="keyword">AS</span> avg_value,
    <span class="function">MAX</span>(metric_value) <span class="keyword">AS</span> max_value,
    <span class="function">COUNT</span>(*) <span class="keyword">AS</span> count_events
<span class="keyword">FROM</span> {{ <span class="function">ref</span>(<span class="string">'stg_metrics'</span>) }}

{% <span class="keyword">if</span> <span class="function">is_incremental</span>() %}
    <span class="comment">-- éå»24æ™‚é–“åˆ†ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ä¸Šæ›¸ã</span>
    <span class="keyword">WHERE</span> metric_hour >= <span class="function">TIMESTAMP_SUB</span>(<span class="function">CURRENT_TIMESTAMP</span>(), <span class="keyword">INTERVAL</span> <span class="number">24</span> <span class="keyword">HOUR</span>)
{% <span class="keyword">endif</span> %}

<span class="keyword">GROUP BY</span> <span class="number">1</span>, <span class="number">2</span>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">âš™ï¸ é‡è¦ãªè¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³</h2>

        <div class="config-section">
            <h3 style="color: #ff694b; margin-top: 0;">ä¸»è¦ãªè¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h3>

            <div class="config-option">
                <h4>materialized</h4>
                <div style="font-size: 14px;">
                    <code>'incremental'</code> ã‚’æŒ‡å®šã—ã¦å¢—åˆ†ãƒ¢ãƒ‡ãƒ«ã‚’æœ‰åŠ¹åŒ–
                </div>
            </div>

            <div class="config-option">
                <h4>incremental_strategy</h4>
                <div style="font-size: 14px;">
                    ãƒ‡ãƒ¼ã‚¿çµ±åˆæ–¹æ³•ã‚’æŒ‡å®š:<br>
                    â€¢ <code>'append'</code>: è¿½åŠ ã®ã¿<br>
                    â€¢ <code>'merge'</code>: UPSERTï¼ˆæ›´æ–° or æŒ¿å…¥ï¼‰<br>
                    â€¢ <code>'delete+insert'</code>: å‰Šé™¤ã—ã¦ã‹ã‚‰æŒ¿å…¥<br>
                    â€¢ <code>'insert_overwrite'</code>: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ä¸Šæ›¸ã
                </div>
            </div>

            <div class="config-option">
                <h4>unique_key</h4>
                <div style="font-size: 14px;">
                    mergeæˆ¦ç•¥ã§é‡è¤‡åˆ¤å®šã«ä½¿ç”¨ã™ã‚‹ã‚­ãƒ¼ã€‚<br>
                    å˜ä¸€ã‚«ãƒ©ãƒ : <code>'user_id'</code><br>
                    è¤‡åˆã‚­ãƒ¼: <code>['order_id', 'item_id']</code>
                </div>
            </div>

            <div class="config-option">
                <h4>partition_by</h4>
                <div style="font-size: 14px;">
                    ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³è¨­å®šï¼ˆBigQueryï¼‰:<br>
                    <code>{'field': 'date', 'data_type': 'date', 'granularity': 'day'}</code>
                </div>
            </div>

            <div class="config-option">
                <h4>cluster_by</h4>
                <div style="font-size: 14px;">
                    ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°è¨­å®šï¼ˆBigQueryï¼‰:<br>
                    <code>['user_id', 'product_id']</code>
                </div>
            </div>

            <div class="config-option">
                <h4>on_schema_change</h4>
                <div style="font-size: 14px;">
                    ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ™‚ã®å‹•ä½œ:<br>
                    â€¢ <code>'ignore'</code>: å¤‰æ›´ã‚’ç„¡è¦–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰<br>
                    â€¢ <code>'fail'</code>: ã‚¨ãƒ©ãƒ¼ã§åœæ­¢<br>
                    â€¢ <code>'append_new_columns'</code>: æ–°ã‚«ãƒ©ãƒ ã‚’è¿½åŠ <br>
                    â€¢ <code>'sync_all_columns'</code>: å…¨ã‚«ãƒ©ãƒ ã‚’åŒæœŸ
                </div>
            </div>

            <div class="config-option">
                <h4>full_refresh</h4>
                <div style="font-size: 14px;">
                    ãƒ•ãƒ«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’å¼·åˆ¶:<br>
                    ã‚³ãƒãƒ³ãƒ‰: <code>dbt run --full-refresh</code><br>
                    ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤ã—ã¦å†ä½œæˆ
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ</h2>

        <div class="performance-comparison">
            <h3 style="text-align: center; color: #ff694b; margin-top: 0;">å®Ÿè¡Œæ™‚é–“ã¨ã‚³ã‚¹ãƒˆã®æ¯”è¼ƒ</h3>
            
            <div style="background: #e8f0fe; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                <strong>ã‚·ãƒŠãƒªã‚ª:</strong> 10å„„è¡Œã®ã‚¤ãƒ™ãƒ³ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã€æ—¥æ¬¡ã§100ä¸‡è¡Œã®æ–°è¦ãƒ‡ãƒ¼ã‚¿è¿½åŠ 
            </div>

            <div class="perf-bar">
                <div class="perf-label">TABLEãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ•ãƒ«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼‰</div>
                <div class="perf-meter">
                    <div class="perf-fill perf-slow">
                        å‡¦ç†æ™‚é–“: 45åˆ† | ã‚³ã‚¹ãƒˆ: $50 | ã‚¹ã‚­ãƒ£ãƒ³: 500 GB
                    </div>
                </div>
            </div>

            <div class="perf-bar">
                <div class="perf-label">Incrementalãƒ¢ãƒ‡ãƒ«ï¼ˆå·®åˆ†æ›´æ–°ï¼‰</div>
                <div class="perf-meter">
                    <div class="perf-fill perf-fast">
                        å‡¦ç†æ™‚é–“: 2åˆ† | ã‚³ã‚¹ãƒˆ: $0.5 | ã‚¹ã‚­ãƒ£ãƒ³: 5 GB
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px;">
                <table>
                    <thead>
                        <tr>
                            <th>æŒ‡æ¨™</th>
                            <th>TABLEãƒ¢ãƒ‡ãƒ«</th>
                            <th>Incrementalãƒ¢ãƒ‡ãƒ«</th>
                            <th>æ”¹å–„ç‡</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>åˆå›å®Ÿè¡Œ</strong></td>
                            <td>45åˆ†</td>
                            <td>45åˆ†</td>
                            <td>åŒã˜</td>
                        </tr>
                        <tr>
                            <td><strong>2å›ç›®ä»¥é™</strong></td>
                            <td>45åˆ†</td>
                            <td>2åˆ†</td>
                            <td><strong>95%çŸ­ç¸®</strong></td>
                        </tr>
                        <tr>
                            <td><strong>ã‚¹ã‚­ãƒ£ãƒ³é‡</strong></td>
                            <td>500 GB</td>
                            <td>5 GB</td>
                            <td><strong>99%å‰Šæ¸›</strong></td>
                        </tr>
                        <tr>
                            <td><strong>ã‚³ã‚¹ãƒˆ/æ—¥</strong></td>
                            <td>$50</td>
                            <td>$0.5</td>
                            <td><strong>99%å‰Šæ¸›</strong></td>
                        </tr>
                        <tr>
                            <td><strong>æœˆé–“ã‚³ã‚¹ãƒˆ</strong></td>
                            <td>$1,500</td>
                            <td>$15</td>
                            <td><strong>$1,485ç¯€ç´„</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">ğŸ¯ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹</h2>

        <div class="use-case">
            <h4>1ï¸âƒ£ ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã®è“„ç©</h4>
            <p><strong>ã‚·ãƒŠãƒªã‚ª:</strong> Webã‚¢ãƒ—ãƒªã®ã‚¯ãƒªãƒƒã‚¯ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’è“„ç©</p>
            <div style="font-size: 14px; margin-top: 10px;">
                <strong>å®Ÿè£…:</strong>
                <ul style="margin: 5px 0;">
                    <li>æˆ¦ç•¥: <code>append</code></li>
                    <li>ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³: <code>event_date</code></li>
                    <li>ãƒ•ã‚£ãƒ«ã‚¿: <code>WHERE event_timestamp > MAX(event_timestamp)</code></li>
                    <li>é »åº¦: æ¯æ™‚å®Ÿè¡Œ</li>
                </ul>
                <strong>åŠ¹æœ:</strong> æ¯æ™‚æ•°ç™¾ä¸‡ä»¶ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’é«˜é€Ÿå‡¦ç†ã€ä½ã‚³ã‚¹ãƒˆ
            </div>
        </div>

        <div class="use-case">
            <h4>2ï¸âƒ£ é¡§å®¢ãƒã‚¹ã‚¿ã®æ›´æ–°</h4>
            <p><strong>ã‚·ãƒŠãƒªã‚ª:</strong> CRMã‹ã‚‰ã®é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ãƒ¼ã‚¿ã‚¦ã‚§ã‚¢ãƒã‚¦ã‚¹ã«åŒæœŸ</p>
            <div style="font-size: 14px; margin-top: 10px;">
                <strong>å®Ÿè£…:</strong>
                <ul style="margin: 5px 0;">
                    <li>æˆ¦ç•¥: <code>merge</code></li>
                    <li>unique_key: <code>customer_id</code></li>
                    <li>ãƒ•ã‚£ãƒ«ã‚¿: <code>WHERE updated_at > MAX(updated_at)</code></li>
                    <li>é »åº¦: æ¯15åˆ†å®Ÿè¡Œ</li>
                </ul>
                <strong>åŠ¹æœ:</strong> å¤‰æ›´ã•ã‚ŒãŸé¡§å®¢ãƒ‡ãƒ¼ã‚¿ã®ã¿æ›´æ–°ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«è¿‘ã„åŒæœŸ
            </div>
        </div>

        <div class="use-case">
            <h4>3ï¸âƒ£ æ—¥æ¬¡å£²ä¸Šé›†è¨ˆ</h4>
            <p><strong>ã‚·ãƒŠãƒªã‚ª:</strong> æ—¥åˆ¥ãƒ»å•†å“åˆ¥ã®å£²ä¸Šã‚µãƒãƒªã‚’è¨ˆç®—</p>
            <div style="font-size: 14px; margin-top: 10px;">
                <strong>å®Ÿè£…:</strong>
                <ul style="margin: 5px 0;">
                    <li>æˆ¦ç•¥: <code>delete+insert</code></li>
                    <li>ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³: <code>sale_date</code></li>
                    <li>ãƒ•ã‚£ãƒ«ã‚¿: éå»7æ—¥åˆ†ã‚’å†è¨ˆç®—ï¼ˆé…å»¶ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰</li>
                    <li>é »åº¦: æ¯æ—¥1å›å®Ÿè¡Œ</li>
                </ul>
                <strong>åŠ¹æœ:</strong> é…å»¶åˆ°ç€ãƒ‡ãƒ¼ã‚¿ã‚‚æ­£ç¢ºã«åæ˜ ã€éå»åˆ†ã‚‚å†è¨ˆç®—å¯èƒ½
            </div>
        </div>

        <div class="use-case">
            <h4>4ï¸âƒ£ CDCï¼ˆChange Data Captureï¼‰</h4>
            <p><strong>ã‚·ãƒŠãƒªã‚ª:</strong> ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¤‰æ›´ãƒ­ã‚°ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£</p>
            <div style="font-size: 14px; margin-top: 10px;">
                <strong>å®Ÿè£…:</strong>
                <ul style="margin: 5px 0;">
                    <li>æˆ¦ç•¥: <code>merge</code></li>
                    <li>unique_key: ãƒ—ãƒ©ã‚¤ãƒãƒªã‚­ãƒ¼</li>
                    <li>ãƒ•ã‚£ãƒ«ã‚¿: <code>WHERE log_timestamp > MAX(log_timestamp)</code></li>
                    <li>å‰Šé™¤ãƒ•ãƒ©ã‚°: <code>is_incremental() and is_deleted</code>ã§å‰Šé™¤å‡¦ç†</li>
                </ul>
                <strong>åŠ¹æœ:</strong> ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å¤‰æ›´ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«åæ˜ 
            </div>
        </div>

        <div class="use-case">
            <h4>5ï¸âƒ£ æ™‚ç³»åˆ—ãƒ¡ãƒˆãƒªã‚¯ã‚¹</h4>
            <p><strong>ã‚·ãƒŠãƒªã‚ª:</strong> 1æ™‚é–“ã”ã¨ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’é›†è¨ˆ</p>
            <div style="font-size: 14px; margin-top: 10px;">
                <strong>å®Ÿè£…:</strong>
                <ul style="margin: 5px 0;">
                    <li>æˆ¦ç•¥: <code>insert_overwrite</code></li>
                    <li>ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³: <code>metric_hour</code>ï¼ˆhourly granularityï¼‰</li>
                    <li>ãƒ•ã‚£ãƒ«ã‚¿: éå»24æ™‚é–“åˆ†ã‚’å†è¨ˆç®—</li>
                    <li>é »åº¦: æ¯æ™‚å®Ÿè¡Œ</li>
                </ul>
                <strong>åŠ¹æœ:</strong> æ™‚é–“å˜ä½ã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚’ä¸Šæ›¸ãã€åŠ¹ç‡çš„ãªæ›´æ–°
            </div>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">âš ï¸ æ³¨æ„ç‚¹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</h2>

        <table>
            <thead>
                <tr>
                    <th>é …ç›®</th>
                    <th>æ¨å¥¨äº‹é …</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶</strong></td>
                    <td>å¿…ãš<code>{% if is_incremental() %}</code>å†…ã«WHEREå¥ã‚’è¨˜è¿°ã€‚åˆå›å®Ÿè¡Œã§ã¯å…¨ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå¿…è¦</td>
                </tr>
                <tr>
                    <td><strong>ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³è¨­å®š</strong></td>
                    <td>æ—¥ä»˜ã‚«ãƒ©ãƒ ã§ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åŒ–ã™ã‚‹ã¨ã€delete+insertã‚„insert_overwriteãŒåŠ¹ç‡çš„</td>
                </tr>
                <tr>
                    <td><strong>unique_keyé¸æŠ</strong></td>
                    <td>mergeæˆ¦ç•¥ã§ã¯é©åˆ‡ãªã‚­ãƒ¼ã‚’é¸æŠã€‚è¤‡åˆã‚­ãƒ¼ã‚‚å¯èƒ½</td>
                </tr>
                <tr>
                    <td><strong>é…å»¶ãƒ‡ãƒ¼ã‚¿å¯¾å¿œ</strong></td>
                    <td>éå»æ•°æ—¥åˆ†ã‚’lookback_windowã§å†å‡¦ç†ã™ã‚‹ã“ã¨ã§é…å»¶ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒãƒ</td>
                </tr>
                <tr>
                    <td><strong>ãƒ•ãƒ«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥</strong></td>
                    <td>å®šæœŸçš„ã«<code>--full-refresh</code>ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å†æ§‹ç¯‰ã—ã€ãƒ‡ãƒ¼ã‚¿å“è³ªã‚’ç¶­æŒ</td>
                </tr>
                <tr>
                    <td><strong>ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</strong></td>
                    <td>å‡¦ç†è¡Œæ•°ã€å®Ÿè¡Œæ™‚é–“ã€ã‚¨ãƒ©ãƒ¼ç‡ã‚’ç›£è¦–ã€‚ç•°å¸¸ãŒã‚ã‚Œã°ãƒ•ãƒ«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥</td>
                </tr>
                <tr>
                    <td><strong>ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´</strong></td>
                    <td><code>on_schema_change</code>ã‚’é©åˆ‡ã«è¨­å®šã—ã€ã‚«ãƒ©ãƒ è¿½åŠ ãƒ»å‰Šé™¤ã«å¯¾å¿œ</td>
                </tr>
            </tbody>
        </table>

        <div class="warning-box">
            <strong>ğŸš¨ IncrementalãŒé©ã•ãªã„ã‚±ãƒ¼ã‚¹:</strong>
            <ul style="margin: 10px 0; font-size: 14px;">
                <li><strong>å°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿:</strong> æ•°åƒã€œæ•°ä¸‡è¡Œç¨‹åº¦ãªã‚‰TABLEãƒ¢ãƒ‡ãƒ«ã§ååˆ†</li>
                <li><strong>è¤‡é›‘ãªJOIN:</strong> ä¸Šæµãƒ†ãƒ¼ãƒ–ãƒ«ã®å¤‰æ›´ã‚’æ¤œçŸ¥ã—ã«ãã„å ´åˆã¯TABLEãŒå®‰å…¨</li>
                <li><strong>å…¨è¡Œå†è¨ˆç®—ãŒå¿…è¦:</strong> ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–¢æ•°ã§å…¨ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ãªå ´åˆ</li>
                <li><strong>é »ç¹ãªã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´:</strong> é–‹ç™ºåˆæœŸæ®µéšã§ã¯TABLEãŒæŸ”è»Ÿ</li>
            </ul>
        </div>

        <div class="benefit-list">
            <h4>âœ… Incrementalã‚’ä½¿ã†ã¹ãã‚±ãƒ¼ã‚¹</h4>
            <ul style="font-size: 14px; line-height: 1.8;">
                <li>ãƒ‡ãƒ¼ã‚¿é‡ãŒæ•°ç™¾ä¸‡è¡Œä»¥ä¸Š</li>
                <li>æ—¥ã€…æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãŒè¿½åŠ ã•ã‚Œã‚‹</li>
                <li>ãƒ•ãƒ«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã«æ™‚é–“ãŒã‹ã‹ã‚Šã™ãã‚‹ï¼ˆ30åˆ†ä»¥ä¸Šï¼‰</li>
                <li>é »ç¹ãªæ›´æ–°ãŒå¿…è¦ï¼ˆæ¯æ™‚ãƒ»æ¯åˆ†ï¼‰</li>
                <li>ã‚³ã‚¹ãƒˆå‰Šæ¸›ãŒé‡è¦</li>
                <li>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚„ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ã§å¢—åˆ†ã‚’è­˜åˆ¥å¯èƒ½</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2 class="section-title">ğŸ”§ é«˜åº¦ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</h2>

        <h3 style="color: #ff694b;">1. Lookback Windowï¼ˆé…å»¶ãƒ‡ãƒ¼ã‚¿å¯¾å¿œï¼‰</h3>
        <div class="code-box">
<span class="comment">-- éå»7æ—¥åˆ†ã‚’å¸¸ã«å†è¨ˆç®—ã—ã¦é…å»¶ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒãƒ</span>
{% <span class="keyword">if</span> <span class="function">is_incremental</span>() %}
    <span class="keyword">WHERE</span> event_date >= <span class="function">DATE_SUB</span>(<span class="function">CURRENT_DATE</span>(), <span class="keyword">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>)
{% <span class="keyword">endif</span> %}
        </div>

        <h3 style="color: #ff694b; margin-top: 20px;">2. æ¡ä»¶ä»˜ããƒ­ã‚¸ãƒƒã‚¯</h3>
        <div class="code-box">
<span class="comment">-- åˆå›å®Ÿè¡Œæ™‚ã®ã¿å±¥æ­´ãƒ‡ãƒ¼ã‚¿å…¨ä½“ã‚’å–å¾—ã€2å›ç›®ä»¥é™ã¯å·®åˆ†ã®ã¿</span>
{% <span class="keyword">if</span> <span class="function">is_incremental</span>() %}
    <span class="keyword">WHERE</span> updated_at > (<span class="keyword">SELECT MAX</span>(updated_at) <span class="keyword">FROM</span> {{ <span class="keyword">this</span> }})
{% <span class="keyword">else</span> %}
    <span class="comment">-- åˆå›ã¯éå»1å¹´åˆ†ã®ã¿å–å¾—ï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿ã¯ä¸è¦ãªå ´åˆï¼‰</span>
    <span class="keyword">WHERE</span> updated_at >= <span class="function">DATE_SUB</span>(<span class="function">CURRENT_DATE</span>(), <span class="keyword">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>)
{% <span class="keyword">endif</span> %}
        </div>

        <h3 style="color: #ff694b; margin-top: 20px;">3. å‰Šé™¤ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å‡¦ç†</h3>
        <div class="code-box">
<span class="comment">-- è«–ç†å‰Šé™¤ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨</span>
{{ <span class="function">config</span>(
    materialized=<span class="string">'incremental'</span>,
    incremental_strategy=<span class="string">'merge'</span>,
    unique_key=<span class="string">'id'</span>
) }}

<span class="keyword">SELECT</span>
    id,
    name,
    is_deleted,
    updated_at
<span class="keyword">FROM</span> {{ <span class="function">source</span>(<span class="string">'raw'</span>, <span class="string">'users'</span>) }}

{% <span class="keyword">if</span> <span class="function">is_incremental</span>() %}
    <span class="keyword">WHERE</span> updated_at > (<span class="keyword">SELECT MAX</span>(updated_at) <span class="keyword">FROM</span> {{ <span class="keyword">this</span> }})
    <span class="comment">-- å‰Šé™¤ã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚‚å«ã‚ã‚‹</span>
    <span class="keyword">OR</span> is_deleted = <span class="keyword">TRUE</span>
{% <span class="keyword">endif</span> %}
        </div>

        <h3 style="color: #ff694b; margin-top: 20px;">4. ã‚«ã‚¹ã‚¿ãƒ ãƒã‚¯ãƒ­ã§ã®å…±é€šåŒ–</h3>
        <div class="code-box">
<span class="comment">-- macros/incremental_filter.sql</span>
{% <span class="keyword">macro</span> incremental_filter(column_name, lookback_days=0) %}
    {% <span class="keyword">if</span> <span class="function">is_incremental</span>() %}
        <span class="keyword">WHERE</span> {{ column_name }} > (
            <span class="keyword">SELECT</span> <span class="function">DATE_SUB</span>(<span class="function">MAX</span>({{ column_name }}), <span class="keyword">INTERVAL</span> {{ lookback_days }} <span class="keyword">DAY</span>)
            <span class="keyword">FROM</span> {{ <span class="keyword">this</span> }}
        )
    {% <span class="keyword">endif</span> %}
{% <span class="keyword">endmacro</span> %}

<span class="comment">-- models/my_model.sql</span>
<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> {{ <span class="function">source</span>(<span class="string">'raw'</span>, <span class="string">'events'</span>) }}
{{ <span class="function">incremental_filter</span>(<span class="string">'event_date'</span>, lookback_days=7) }}
        </div>
    </div>

    <div class="container">
        <h2>ğŸ“š ã¾ã¨ã‚</h2>
        <div style="background: #fff4f2; padding: 20px; border-radius: 8px; border-left: 4px solid #ff694b;">
            <h3 style="color: #d84315; margin-top: 0;">ğŸ“ dbt Incremental Modelã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h3>
            
            <ul style="line-height: 1.8;">
                <li><strong>ç›®çš„:</strong> å¤§é‡ãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã€ã‚³ã‚¹ãƒˆã¨æ™‚é–“ã‚’å¤§å¹…å‰Šæ¸›</li>
                <li><strong>ä»•çµ„ã¿:</strong> åˆå›ã¯å…¨ãƒ‡ãƒ¼ã‚¿ã€2å›ç›®ä»¥é™ã¯å·®åˆ†ã®ã¿å‡¦ç†</li>
                <li><strong>æˆ¦ç•¥:</strong> appendï¼ˆè¿½åŠ ï¼‰ã€mergeï¼ˆUPSERTï¼‰ã€delete+insertã€insert_overwrite</li>
                <li><strong>å¿…é ˆè¨­å®š:</strong> <code>materialized='incremental'</code>ã€<code>is_incremental()</code>ã§ãƒ•ã‚£ãƒ«ã‚¿</li>
                <li><strong>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹:</strong> å‡¦ç†æ™‚é–“99%çŸ­ç¸®ã€ã‚³ã‚¹ãƒˆ99%å‰Šæ¸›ã‚‚å¯èƒ½</li>
                <li><strong>é©ç”¨å ´é¢:</strong> ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã€ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³æ›´æ–°ã€æ—¥æ¬¡é›†è¨ˆã€CDC</li>
            </ul>

            <div style="background: #e8f5e9; padding: 15px; border-radius: 5px; margin-top: 15px;">
                <strong style="color: #2e7d32;">ğŸ’¡ ä½¿ã„åˆ†ã‘ã®åŸºæº–:</strong>
                <ul style="margin: 10px 0; font-size: 14px;">
                    <li><strong>TABLE:</strong> å°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼ˆã€œæ•°åä¸‡è¡Œï¼‰ã€é–‹ç™ºåˆæœŸã€è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯</li>
                    <li><strong>INCREMENTAL:</strong> å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼ˆæ•°ç™¾ä¸‡è¡Œä»¥ä¸Šï¼‰ã€é »ç¹ãªæ›´æ–°ã€ã‚³ã‚¹ãƒˆé‡è¦–</li>
                    <li><strong>VIEW:</strong> è»½é‡ãªå¤‰æ›ã®ã¿ã€å¸¸ã«æœ€æ–°ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦</li>
                </ul>
            </div>

            <div style="text-align: center; margin-top: 20px; font-size: 18px; font-weight: bold; color: #d84315;">
                Incremental Modelã«ã‚ˆã‚Šã€<br>
                å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’é«˜é€Ÿãƒ»ä½ã‚³ã‚¹ãƒˆã§å®Ÿç¾ã§ãã¾ã™ï¼
            </div>
        </div>
    </div>

</body>
</html>
