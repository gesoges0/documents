<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dataflow ã®ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆShuffleï¼‰è§£èª¬</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        h1 {
            color: #1a73e8;
            text-align: center;
            margin-bottom: 40px;
        }
        h2 {
            color: #333;
            margin-top: 40px;
            border-bottom: 3px solid #1a73e8;
            padding-bottom: 10px;
        }
        .concept-box {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .highlight-box {
            background: #e3f2fd;
            border-left: 5px solid #1a73e8;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .warning-box {
            background: #fff3e0;
            border-left: 5px solid #ff9800;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .diagram-container {
            background: #fafafa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }
        .worker-box {
            display: inline-block;
            background: #4285f4;
            color: white;
            padding: 15px 20px;
            margin: 10px;
            border-radius: 8px;
            font-weight: bold;
            min-width: 150px;
        }
        .worker-input {
            background: #34a853;
        }
        .worker-output {
            background: #ea4335;
        }
        .data-item {
            display: inline-block;
            background: #fbbc04;
            color: #333;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.9em;
        }
        .shuffle-arrow {
            font-size: 40px;
            color: #666;
            margin: 20px 0;
        }
        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .comparison-table th {
            background: #1a73e8;
            color: white;
            padding: 15px;
            text-align: left;
        }
        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }
        .comparison-table tr:hover {
            background: #f5f5f5;
        }
        .code-block {
            background: #263238;
            color: #aed581;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
        }
        .step-number {
            display: inline-block;
            background: #1a73e8;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: bold;
            margin-right: 10px;
        }
        .step-item {
            margin: 25px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        ul {
            padding-left: 20px;
        }
        li {
            margin: 10px 0;
        }
        .network-line {
            border-top: 3px dashed #ff9800;
            margin: 20px 0;
            position: relative;
        }
        .network-label {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff3e0;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            color: #ff9800;
        }
    </style>
</head>
<body>
    <h1>ğŸ”€ Dataflow ã®ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆShuffleï¼‰ã¨ã¯ï¼Ÿ</h1>

    <div class="concept-box">
        <h2 style="margin-top: 0;">ğŸ“Œ ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã®åŸºæœ¬æ¦‚å¿µ</h2>
        <p style="font-size: 1.1em;">
            <strong>ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆShuffleï¼‰</strong>ã¨ã¯ã€åˆ†æ•£å‡¦ç†ã«ãŠã„ã¦<strong>ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ¼ã”ã¨ã«å†åˆ†é…ï¼ˆå†ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼‰ã™ã‚‹æ“ä½œ</strong>ã®ã“ã¨ã§ã™ã€‚
        </p>
        <div class="highlight-box">
            <strong>ğŸ¯ ç°¡å˜ã«è¨€ã†ã¨ï¼š</strong>
            <p>è¤‡æ•°ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ï¼ˆå‡¦ç†ãƒã‚·ãƒ³ï¼‰ã«åˆ†æ•£ã—ã¦ã„ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã€ç‰¹å®šã®ã‚­ãƒ¼ã«åŸºã¥ã„ã¦å†é…ç½®ã—ã€åŒã˜ã‚­ãƒ¼ã‚’æŒã¤ãƒ‡ãƒ¼ã‚¿ã‚’åŒã˜ãƒ¯ãƒ¼ã‚«ãƒ¼ã«é›†ã‚ã‚‹å‡¦ç†ã§ã™ã€‚</p>
        </div>
    </div>

    <h2>ğŸ” ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãŒç™ºç”Ÿã™ã‚‹å…¸å‹çš„ãªæ“ä½œ</h2>

    <div class="concept-box">
        <div class="grid-container">
            <div>
                <h3 style="color: #1a73e8;">GroupByKey</h3>
                <p>ã‚­ãƒ¼ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–</p>
                <div class="code-block">
# ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãŒç™ºç”Ÿ
data | beam.GroupByKey()
                </div>
            </div>
            <div>
                <h3 style="color: #1a73e8;">CoGroupByKey</h3>
                <p>è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ã‚­ãƒ¼ã§çµåˆ</p>
                <div class="code-block">
# ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãŒç™ºç”Ÿ
{'orders': orders, 'users': users} \
| beam.CoGroupByKey()
                </div>
            </div>
            <div>
                <h3 style="color: #1a73e8;">Combineï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼‰</h3>
                <p>å…¨ãƒ‡ãƒ¼ã‚¿ã‚’é›†ç´„</p>
                <div class="code-block">
# ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãŒç™ºç”Ÿ
data | beam.CombineGlobally(sum)
                </div>
            </div>
            <div>
                <h3 style="color: #1a73e8;">Distinct</h3>
                <p>é‡è¤‡ã‚’é™¤å»</p>
                <div class="code-block">
# ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãŒç™ºç”Ÿ
data | beam.Distinct()
                </div>
            </div>
        </div>
    </div>

    <h2>ğŸ¬ ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã®å‹•ä½œã‚¤ãƒ¡ãƒ¼ã‚¸</h2>

    <div class="diagram-container">
        <h3 style="margin-top: 0;">GroupByKeyã®ä¾‹ï¼šé¡§å®¢IDã”ã¨ã«è³¼å…¥å±¥æ­´ã‚’é›†ç´„</h3>
        
        <div style="margin: 30px 0;">
            <h4 style="color: #34a853;">â–¼ ã‚·ãƒ£ãƒƒãƒ•ãƒ«å‰ï¼ˆå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒåˆ†æ•£ï¼‰</h4>
            <div style="display: flex; justify-content: center; gap: 30px; margin: 20px 0;">
                <div>
                    <div class="worker-box worker-input">Worker 1</div>
                    <div style="margin-top: 10px;">
                        <div class="data-item">A: ã‚Šã‚“ã”</div>
                        <div class="data-item">B: ã¿ã‹ã‚“</div>
                        <div class="data-item">C: ãƒãƒŠãƒŠ</div>
                    </div>
                </div>
                <div>
                    <div class="worker-box worker-input">Worker 2</div>
                    <div style="margin-top: 10px;">
                        <div class="data-item">A: ã¶ã©ã†</div>
                        <div class="data-item">C: ã„ã¡ã”</div>
                        <div class="data-item">B: ãƒ¡ãƒ­ãƒ³</div>
                    </div>
                </div>
                <div>
                    <div class="worker-box worker-input">Worker 3</div>
                    <div style="margin-top: 10px;">
                        <div class="data-item">A: ã‚‚ã‚‚</div>
                        <div class="data-item">B: ãªã—</div>
                        <div class="data-item">C: ã‚­ã‚¦ã‚¤</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="shuffle-arrow">â¬‡ï¸ ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆãƒ‡ãƒ¼ã‚¿å†é…ç½®ï¼‰â¬‡ï¸</div>
        
        <div class="network-line">
            <span class="network-label">ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è»¢é€</span>
        </div>

        <div style="margin: 30px 0;">
            <h4 style="color: #ea4335;">â–¼ ã‚·ãƒ£ãƒƒãƒ•ãƒ«å¾Œï¼ˆã‚­ãƒ¼ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼‰</h4>
            <div style="display: flex; justify-content: center; gap: 30px; margin: 20px 0;">
                <div>
                    <div class="worker-box worker-output">Worker 1</div>
                    <div style="margin-top: 10px;">
                        <div class="data-item">A: ã‚Šã‚“ã”</div>
                        <div class="data-item">A: ã¶ã©ã†</div>
                        <div class="data-item">A: ã‚‚ã‚‚</div>
                    </div>
                    <div style="margin-top: 10px; font-weight: bold; color: #333;">
                        â†“<br/>A: [ã‚Šã‚“ã”, ã¶ã©ã†, ã‚‚ã‚‚]
                    </div>
                </div>
                <div>
                    <div class="worker-box worker-output">Worker 2</div>
                    <div style="margin-top: 10px;">
                        <div class="data-item">B: ã¿ã‹ã‚“</div>
                        <div class="data-item">B: ãƒ¡ãƒ­ãƒ³</div>
                        <div class="data-item">B: ãªã—</div>
                    </div>
                    <div style="margin-top: 10px; font-weight: bold; color: #333;">
                        â†“<br/>B: [ã¿ã‹ã‚“, ãƒ¡ãƒ­ãƒ³, ãªã—]
                    </div>
                </div>
                <div>
                    <div class="worker-box worker-output">Worker 3</div>
                    <div style="margin-top: 10px;">
                        <div class="data-item">C: ãƒãƒŠãƒŠ</div>
                        <div class="data-item">C: ã„ã¡ã”</div>
                        <div class="data-item">C: ã‚­ã‚¦ã‚¤</div>
                    </div>
                    <div style="margin-top: 10px; font-weight: bold; color: #333;">
                        â†“<br/>C: [ãƒãƒŠãƒŠ, ã„ã¡ã”, ã‚­ã‚¦ã‚¤]
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h2>âš™ï¸ ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã®ãƒ—ãƒ­ã‚»ã‚¹è©³ç´°</h2>

    <div class="concept-box">
        <div class="step-item">
            <span class="step-number">1</span>
            <strong>ãƒ‡ãƒ¼ã‚¿ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ï¼ˆåˆ†å‰²ï¼‰</strong>
            <p>å„ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒä¿æŒã—ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã€ã‚­ãƒ¼ã®ãƒãƒƒã‚·ãƒ¥å€¤ã«åŸºã¥ã„ã¦é€ä¿¡å…ˆãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’æ±ºå®šã—ã¾ã™ã€‚</p>
        </div>

        <div class="step-item">
            <span class="step-number">2</span>
            <strong>ä¸­é–“ãƒ‡ãƒ¼ã‚¿ã®æ›¸ãè¾¼ã¿</strong>
            <p>é€ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ™‚çš„ã«ãƒ‡ã‚£ã‚¹ã‚¯ï¼ˆã¾ãŸã¯ Shuffle Serviceï¼‰ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚</p>
        </div>

        <div class="step-item">
            <span class="step-number">3</span>
            <strong>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è»¢é€</strong>
            <p>ãƒ¯ãƒ¼ã‚«ãƒ¼é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã—ã¾ã™ã€‚ã“ã‚ŒãŒæœ€ã‚‚ã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹éƒ¨åˆ†ã§ã™ã€‚</p>
        </div>

        <div class="step-item">
            <span class="step-number">4</span>
            <strong>ãƒ‡ãƒ¼ã‚¿ã®å—ä¿¡ã¨ã‚½ãƒ¼ãƒˆ</strong>
            <p>å—ä¿¡å´ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€ã‚­ãƒ¼ã”ã¨ã«ã‚½ãƒ¼ãƒˆã—ã¦å‡¦ç†å¯èƒ½ãªçŠ¶æ…‹ã«ã—ã¾ã™ã€‚</p>
        </div>

        <div class="step-item">
            <span class="step-number">5</span>
            <strong>å¾Œç¶šå‡¦ç†ã®å®Ÿè¡Œ</strong>
            <p>ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã€æ¬¡ã®å¤‰æ›å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>
        </div>
    </div>

    <h2>ğŸš€ Dataflow Shuffle vs Batch Shuffle</h2>

    <table class="comparison-table">
        <thead>
            <tr>
                <th>é …ç›®</th>
                <th>Batch Shuffleï¼ˆå¾“æ¥å‹ï¼‰</th>
                <th>Dataflow Shuffleï¼ˆæœ€é©åŒ–ç‰ˆï¼‰</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜å…ˆ</strong></td>
                <td>å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯</td>
                <td>Dataflow Shuffle Serviceï¼ˆå°‚ç”¨ã‚µãƒ¼ãƒ“ã‚¹ï¼‰</td>
            </tr>
            <tr>
                <td><strong>ãƒ¯ãƒ¼ã‚«ãƒ¼é–“é€šä¿¡</strong></td>
                <td>ãƒ¯ãƒ¼ã‚«ãƒ¼åŒå£«ãŒç›´æ¥é€šä¿¡</td>
                <td>Shuffle ServiceçµŒç”±ã§é›†ä¸­ç®¡ç†</td>
            </tr>
            <tr>
                <td><strong>è€éšœå®³æ€§</strong></td>
                <td>ãƒ¯ãƒ¼ã‚«ãƒ¼éšœå®³æ™‚ã«å†è¨ˆç®—ãŒå¿…è¦</td>
                <td>Shuffle Service ã«ãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã‚‹ãŸã‚å†è¨ˆç®—ä¸è¦</td>
            </tr>
            <tr>
                <td><strong>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</strong></td>
                <td>ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°ãŒå¢—ãˆã‚‹ã¨åŠ¹ç‡ä½ä¸‹</td>
                <td>å¤§è¦æ¨¡ã§ã‚‚é«˜åŠ¹ç‡</td>
            </tr>
            <tr>
                <td><strong>ã‚³ã‚¹ãƒˆ</strong></td>
                <td>ãƒ¯ãƒ¼ã‚«ãƒ¼ã®CPU/ãƒ¡ãƒ¢ãƒªãƒªã‚½ãƒ¼ã‚¹ã‚’æ¶ˆè²»</td>
                <td>Shuffle Serviceåˆ©ç”¨æ–™ãŒç™ºç”Ÿï¼ˆåŠ¹ç‡çš„ï¼‰</td>
            </tr>
            <tr>
                <td><strong>ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</strong></td>
                <td>ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°ã«é™ç•Œã‚ã‚Š</td>
                <td>æ•°åƒãƒ¯ãƒ¼ã‚«ãƒ¼ã§ã‚‚ã‚¹ã‚±ãƒ¼ãƒ«å¯èƒ½</td>
            </tr>
        </tbody>
    </table>

    <h2>âš ï¸ ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã®ã‚³ã‚¹ãƒˆã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿</h2>

    <div class="warning-box">
        <h3 style="margin-top: 0;">ğŸ”¥ ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãŒé«˜ã‚³ã‚¹ãƒˆãªç†ç”±</h3>
        <ul>
            <li><strong>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯I/Oï¼š</strong> ãƒ¯ãƒ¼ã‚«ãƒ¼é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã™ã‚‹ãŸã‚ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¸¯åŸŸã‚’å¤§é‡ã«æ¶ˆè²»</li>
            <li><strong>ãƒ‡ã‚£ã‚¹ã‚¯I/Oï¼š</strong> ä¸­é–“ãƒ‡ãƒ¼ã‚¿ã®æ›¸ãè¾¼ã¿ãƒ»èª­ã¿è¾¼ã¿ãŒç™ºç”Ÿ</li>
            <li><strong>ãƒ¡ãƒ¢ãƒªä½¿ç”¨ï¼š</strong> ãƒ‡ãƒ¼ã‚¿ã®ã‚½ãƒ¼ãƒˆã‚„ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã§ãƒ¡ãƒ¢ãƒªã‚’æ¶ˆè²»</li>
            <li><strong>å‡¦ç†æ™‚é–“ï¼š</strong> ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚„ã‚½ãƒ¼ãƒˆå‡¦ç†ã«æ™‚é–“ãŒã‹ã‹ã‚‹</li>
        </ul>
    </div>

    <div class="concept-box">
        <h3>ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ä¾‹</h3>
        <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <p><strong>ä¾‹ï¼š1TB ã®ãƒ‡ãƒ¼ã‚¿ã‚’ GroupByKey ã§å‡¦ç†ã™ã‚‹å ´åˆ</strong></p>
            <ul>
                <li>ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãªã—ã®å‡¦ç†: ç´„10åˆ†</li>
                <li>ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã‚ã‚Šã®å‡¦ç†: ç´„40åˆ†ã€œ60åˆ†</li>
                <li>ã‚³ã‚¹ãƒˆå¢—åŠ : 2ã€œ3å€</li>
            </ul>
            <p style="color: #666; font-size: 0.95em; margin-top: 15px;">
                â€» ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ•£çŠ¶æ³ã‚„ã‚­ãƒ¼ã®åã‚Šã«ã‚ˆã£ã¦å¤§ããå¤‰å‹•ã—ã¾ã™
            </p>
        </div>
    </div>

    <h2>ğŸ’¡ ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã‚’æœ€é©åŒ–ã™ã‚‹ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</h2>

    <div class="grid-container">
        <div class="concept-box">
            <h3 style="color: #34a853;">âœ… ã‚„ã‚‹ã¹ãã“ã¨</h3>
            <ul>
                <li><strong>CombinePerKey ã‚’ä½¿ã†</strong>
                    <p style="font-size: 0.9em; color: #666;">GroupByKey ã®å‰ã«äº‹å‰é›†ç´„ã‚’è¡Œã„ã€è»¢é€ãƒ‡ãƒ¼ã‚¿é‡ã‚’å‰Šæ¸›</p>
                </li>
                <li><strong>Dataflow Shuffle ã‚’æœ‰åŠ¹åŒ–</strong>
                    <p style="font-size: 0.9em; color: #666;">--experiments=shuffle_mode=service ãƒ•ãƒ©ã‚°ã§æœ‰åŠ¹åŒ–</p>
                </li>
                <li><strong>ã‚­ãƒ¼ã®åã‚Šã‚’é¿ã‘ã‚‹</strong>
                    <p style="font-size: 0.9em; color: #666;">ç‰¹å®šã‚­ãƒ¼ã«ãƒ‡ãƒ¼ã‚¿ãŒé›†ä¸­ã—ãªã„ã‚ˆã†ã«è¨­è¨ˆ</p>
                </li>
                <li><strong>Combiner ã‚’æ´»ç”¨</strong>
                    <p style="font-size: 0.9em; color: #666;">éƒ¨åˆ†é›†ç´„ã§è»¢é€ãƒ‡ãƒ¼ã‚¿ã‚’åœ§ç¸®</p>
                </li>
            </ul>
        </div>

        <div class="concept-box">
            <h3 style="color: #ea4335;">âŒ é¿ã‘ã‚‹ã¹ãã“ã¨</h3>
            <ul>
                <li><strong>ä¸è¦ãª GroupByKey</strong>
                    <p style="font-size: 0.9em; color: #666;">æœ¬å½“ã«å¿…è¦ã‹å†æ¤œè¨ã™ã‚‹</p>
                </li>
                <li><strong>å¤§ããª Value ã®ä¿æŒ</strong>
                    <p style="font-size: 0.9em; color: #666;">Key-Value ã® Value ã‚µã‚¤ã‚ºã‚’æœ€å°é™ã«</p>
                </li>
                <li><strong>å¤šæ®µ GroupByKey</strong>
                    <p style="font-size: 0.9em; color: #666;">é€£ç¶šã—ãŸã‚·ãƒ£ãƒƒãƒ•ãƒ«ã¯æ¥µåŠ›é¿ã‘ã‚‹</p>
                </li>
                <li><strong>ãƒ›ãƒƒãƒˆã‚­ãƒ¼ã®æ”¾ç½®</strong>
                    <p style="font-size: 0.9em; color: #666;">ç‰¹å®šã‚­ãƒ¼ã¸ã®ãƒ‡ãƒ¼ã‚¿é›†ä¸­ã‚’è§£æ¶ˆ</p>
                </li>
            </ul>
        </div>
    </div>

    <h2>ğŸ“ ã‚³ãƒ¼ãƒ‰ä¾‹ï¼šæœ€é©åŒ–å‰ vs æœ€é©åŒ–å¾Œ</h2>

    <div class="grid-container">
        <div>
            <h3 style="color: #ea4335;">âŒ éåŠ¹ç‡ãªã‚³ãƒ¼ãƒ‰</h3>
            <div class="code-block">
<span style="color: #82aaff;">import</span> apache_beam <span style="color: #82aaff;">as</span> beam

<span style="color: #999;"># å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³¼å…¥ç·é¡ã‚’è¨ˆç®—</span>
result = (
    p
    | beam.io.ReadFromText(<span style="color: #c3e88d;">'purchases.csv'</span>)
    | beam.Map(<span style="color: #82aaff;">lambda</span> x: x.split(<span style="color: #c3e88d;">','</span>))
    | beam.Map(<span style="color: #82aaff;">lambda</span> x: 
        (x[0], <span style="color: #f78c6c;">float</span>(x[1])))
    | beam.GroupByKey()  <span style="color: #ff5370;"># ã‚·ãƒ£ãƒƒãƒ•ãƒ«ç™ºç”Ÿ</span>
    | beam.Map(<span style="color: #82aaff;">lambda</span> x: 
        (x[0], <span style="color: #f78c6c;">sum</span>(x[1])))
)
            </div>
            <p style="color: #666; margin-top: 10px;">
                <strong>å•é¡Œç‚¹ï¼š</strong> å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦ã‹ã‚‰é›†ç´„ã—ã¦ã„ã‚‹
            </p>
        </div>

        <div>
            <h3 style="color: #34a853;">âœ… æœ€é©åŒ–ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰</h3>
            <div class="code-block">
<span style="color: #82aaff;">import</span> apache_beam <span style="color: #82aaff;">as</span> beam

<span style="color: #999;"># CombinePerKey ã§åŠ¹ç‡çš„ã«é›†ç´„</span>
result = (
    p
    | beam.io.ReadFromText(<span style="color: #c3e88d;">'purchases.csv'</span>)
    | beam.Map(<span style="color: #82aaff;">lambda</span> x: x.split(<span style="color: #c3e88d;">','</span>))
    | beam.Map(<span style="color: #82aaff;">lambda</span> x: 
        (x[0], <span style="color: #f78c6c;">float</span>(x[1])))
    | beam.CombinePerKey(<span style="color: #f78c6c;">sum</span>)  <span style="color: #aed581;"># åŠ¹ç‡çš„</span>
)
            </div>
            <p style="color: #666; margin-top: 10px;">
                <strong>æ”¹å–„ç‚¹ï¼š</strong> äº‹å‰é›†ç´„ã«ã‚ˆã‚Šè»¢é€ãƒ‡ãƒ¼ã‚¿é‡ã‚’å¤§å¹…å‰Šæ¸›
            </p>
        </div>
    </div>

    <h2>ğŸ¯ ã¾ã¨ã‚</h2>

    <div class="concept-box">
        <div style="background: #e3f2fd; padding: 25px; border-radius: 8px;">
            <h3 style="margin-top: 0; color: #1a73e8;">ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ</h3>
            <ul style="font-size: 1.05em;">
                <li><strong>ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã¨ã¯ï¼š</strong> ã‚­ãƒ¼ã«åŸºã¥ã„ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å†åˆ†é…ã™ã‚‹æ“ä½œ</li>
                <li><strong>ç™ºç”Ÿã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼š</strong> GroupByKeyã€CoGroupByKeyã€ã‚°ãƒ­ãƒ¼ãƒãƒ«é›†ç´„ãªã©ã§ç™ºç”Ÿ</li>
                <li><strong>ã‚³ã‚¹ãƒˆï¼š</strong> ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ»ãƒ‡ã‚£ã‚¹ã‚¯I/O ãŒå¤§ããã€å‡¦ç†æ™‚é–“ã¨ã‚³ã‚¹ãƒˆã«å½±éŸ¿</li>
                <li><strong>æœ€é©åŒ–ï¼š</strong> CombinePerKeyã€Dataflow Shuffle Service ã®åˆ©ç”¨ãŒåŠ¹æœçš„</li>
                <li><strong>è¨­è¨ˆæ€æƒ³ï¼š</strong> ä¸è¦ãªã‚·ãƒ£ãƒƒãƒ•ãƒ«ã‚’é¿ã‘ã€å¿…è¦ãªå ´åˆã¯åŠ¹ç‡åŒ–ã™ã‚‹</li>
            </ul>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #fff3e0; border-radius: 8px;">
            <strong>ğŸ’¡ å®Ÿå‹™ã§ã®å¿ƒæ§‹ãˆï¼š</strong>
            <p>å¤§å´ã®ã‚ªãƒ•ã‚£ã‚¹ã§Dataflowãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’è¨­è¨ˆã™ã‚‹éš›ã¯ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«ãŒç™ºç”Ÿã™ã‚‹ç®‡æ‰€ã‚’æ„è­˜ã—ã€ãƒ‡ãƒ¼ã‚¿é‡ãŒå¤§ãã„å ´åˆã¯å¿…ãšæœ€é©åŒ–ã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ï¼ç‰¹ã«GCP Data Engineerè©¦é¨“ã§ã‚‚é »å‡ºã®ãƒ†ãƒ¼ãƒã§ã™ã€‚</p>
        </div>
    </div>

</body>
</html>
